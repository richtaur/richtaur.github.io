<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<meta name="description" content="">
	<meta name="keywords" content="">
	<title>Bats</title>


	<style>html,
body {
	overflow: hidden;
	margin: 0;
	background: #000;
}
</style>

	<script>
/*
Djinn Copyright © 2010-2014 Lost Decade Games, LLC

Bats Copyright © -2014 

*/

// Djinn globally accessible functions
// Everything in here should have a damn good reason for being global :)

// requestAnimationFrame polyfill by Erik Möller. fixes from Paul Irish and Tino Zijdel
// MIT license
// http://paulirish.com/2011/requestanimationframe-for-smart-animating/
// http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating
(function () {
	var lastTime = 0;
	var vendors = ["ms", "moz", "webkit", "o"];
	for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
		window.requestAnimationFrame = window[vendors[x] + "RequestAnimationFrame"];
		window.cancelAnimationFrame = window[vendors[x] + "CancelAnimationFrame"]
			|| window[vendors[x] + "CancelRequestAnimationFrame"];
	}

	if (!window.requestAnimationFrame) {
		window.requestAnimationFrame = function (callback, element) {
			var currTime = new Date().getTime();
			var timeToCall = Math.max(0, 16 - (currTime - lastTime));
			var id = window.setTimeout(
				function () { callback(currTime + timeToCall); },
				timeToCall
			);
			lastTime = currTime + timeToCall;
			return id;
		};
	}

	if (!window.cancelAnimationFrame) {
		window.cancelAnimationFrame = function (id) {
			clearTimeout(id);
		};
	}
}());

// Bind a function to a specific context
// Global because function.bind is slower than a custom implementation
// Used everywhere, a lot so it'd be really tedious to include a file for bind
var bind = function globalBind (context, fn) {
	if (typeof fn == "string") {
		fn = context[fn];
	}
	return function globalBindInner () {
		fn.apply(context, arguments);
	};
};

// Merge N objects together
// I'd rather this live in utils/object but it's used in so many places :(
// TODO: Figure out how to move this out of global without a huge mess
var merge = function globalMerge () {
	var merged = {};
	for (var i = arguments.length - 1; i >= 0; --i) {
		var toMerge = arguments[i];

		if (typeof toMerge != "object") { continue; }

		for (var key in toMerge) {
			var prop = toMerge[key];
			if (prop === undefined) { continue; }

			if (prop && typeof prop.concat == "function") {
				// An array
				merged[key] = prop.concat([]);
			} else if (prop && prop.constructor === Object) {
				// A merge-able object
				merged[key] = arguments.callee(prop, merged[key]);
			} else {
				// A scalar or un-mergeable object
				// WARNING: This will copy the reference to an object!
				merged[key] = prop;
			}
		}
	}
	return merged;
};

// Logging
var logger = (typeof console != "undefined") ? console : {
	error: function () {},
	info: function () {},
	log: function () {},
	table: function () {},
	warn: function () {}
};

// TODO: More graceful stubbing of logger functions
// CocoonJS doesn't support console.info
if (typeof logger.info !== "function") {
	logger.info = logger.log;
}

/*!
 *  howler.js v1.1.21
 *  howlerjs.com
 *
 *  (c) 2013-2014, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
!function(){var e={},t=null,n=!0,r=!1;try{"undefined"!=typeof AudioContext?t=new AudioContext:"undefined"!=typeof webkitAudioContext?t=new webkitAudioContext:n=!1}catch(i){n=!1}if(!n)if("undefined"!=typeof Audio)try{new Audio}catch(i){r=!0}else r=!0;if(n){var s=void 0===t.createGain?t.createGainNode():t.createGain();s.gain.value=1,s.connect(t.destination)}var o=function(){this._volume=1,this._muted=!1,this.usingWebAudio=n,this.noAudio=r,this._howls=[]};o.prototype={volume:function(e){var t=this;if(e=parseFloat(e),e>=0&&1>=e){t._volume=e,n&&(s.gain.value=e);for(var r in t._howls)if(t._howls.hasOwnProperty(r)&&t._howls[r]._webAudio===!1)for(var i=0;i<t._howls[r]._audioNode.length;i++)t._howls[r]._audioNode[i].volume=t._howls[r]._volume*t._volume;return t}return n?s.gain.value:t._volume},mute:function(){return this._setMuted(!0),this},unmute:function(){return this._setMuted(!1),this},_setMuted:function(e){var t=this;t._muted=e,n&&(s.gain.value=e?0:t._volume);for(var r in t._howls)if(t._howls.hasOwnProperty(r)&&t._howls[r]._webAudio===!1)for(var i=0;i<t._howls[r]._audioNode.length;i++)t._howls[r]._audioNode[i].muted=e}};var u=new o,a=null;if(!r){a=new Audio;var f={mp3:!!a.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!a.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(a.canPlayType("audio/x-mp4;")||a.canPlayType("audio/mp4;")||a.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")}}var l=function(e){var t=this;t._autoplay=e.autoplay||!1,t._buffer=e.buffer||!1,t._duration=e.duration||0,t._format=e.format||null,t._loop=e.loop||!1,t._loaded=!1,t._sprite=e.sprite||{},t._src=e.src||"",t._pos3d=e.pos3d||[0,0,-.5],t._volume=void 0!==e.volume?e.volume:1,t._urls=e.urls||[],t._rate=e.rate||1,t._model=e.model||null,t._onload=[e.onload||function(){}],t._onloaderror=[e.onloaderror||function(){}],t._onend=[e.onend||function(){}],t._onpause=[e.onpause||function(){}],t._onplay=[e.onplay||function(){}],t._onendTimer=[],t._webAudio=n&&!t._buffer,t._audioNode=[],t._webAudio&&t._setupAudioNode(),u._howls.push(t),t.load()};if(l.prototype={load:function(){var t=this,n=null;if(r)return void t.on("loaderror");for(var i=0;i<t._urls.length;i++){var s,a;if(t._format)s=t._format;else{if(a=t._urls[i].toLowerCase().split("?")[0],s=a.match(/.+\.([^?]+)(\?|$)/),s=s&&s.length>=2?s:a.match(/data\:audio\/([^?]+);/),!s)return void t.on("loaderror");s=s[1]}if(f[s]){n=t._urls[i];break}}if(!n)return void t.on("loaderror");if(t._src=n,t._webAudio)c(t,n);else{var l=new Audio;l.addEventListener("error",function(){l.error&&4===l.error.code&&(o.noAudio=!0),t.on("loaderror",{type:l.error?l.error.code:0})},!1),t._audioNode.push(l),l.src=n,l._pos=0,l.preload="auto",l.volume=u._muted?0:t._volume*u.volume(),e[n]=t;var h=function(){t._duration=Math.ceil(10*l.duration)/10,0===Object.getOwnPropertyNames(t._sprite).length&&(t._sprite={_default:[0,1e3*t._duration]}),t._loaded||(t._loaded=!0,t.on("load")),t._autoplay&&t.play(),l.removeEventListener("canplaythrough",h,!1)};l.addEventListener("canplaythrough",h,!1),l.load()}return t},urls:function(e){var t=this;return e?(t.stop(),t._urls="string"==typeof e?[e]:e,t._loaded=!1,t.load(),t):t._urls},play:function(e,n){var r=this;return"function"==typeof e&&(n=e),e&&"function"!=typeof e||(e="_default"),r._loaded?r._sprite[e]?(r._inactiveNode(function(i){i._sprite=e;var s=i._pos>0?i._pos:r._sprite[e][0]/1e3,o=0;r._webAudio?(o=r._sprite[e][1]/1e3-i._pos,i._pos>0&&(s=r._sprite[e][0]/1e3+s)):o=r._sprite[e][1]/1e3-(s-r._sprite[e][0]/1e3);var a,f=!(!r._loop&&!r._sprite[e][2]),l="string"==typeof n?n:Math.round(Date.now()*Math.random())+"";if(function(){var t={id:l,sprite:e,loop:f};a=setTimeout(function(){!r._webAudio&&f&&r.stop(t.id).play(e,t.id),r._webAudio&&!f&&(r._nodeById(t.id).paused=!0,r._nodeById(t.id)._pos=0),r._webAudio||f||r.stop(t.id),r.on("end",l)},1e3*o),r._onendTimer.push({timer:a,id:t.id})}(),r._webAudio){var c=r._sprite[e][0]/1e3,h=r._sprite[e][1]/1e3;i.id=l,i.paused=!1,p(r,[f,c,h],l),r._playStart=t.currentTime,i.gain.value=r._volume,void 0===i.bufferSource.start?i.bufferSource.noteGrainOn(0,s,o):i.bufferSource.start(0,s,o)}else{if(4!==i.readyState&&(i.readyState||!navigator.isCocoonJS))return r._clearEndTimer(l),function(){var t=r,s=e,o=n,u=i,a=function(){t.play(s,o),u.removeEventListener("canplaythrough",a,!1)};u.addEventListener("canplaythrough",a,!1)}(),r;i.readyState=4,i.id=l,i.currentTime=s,i.muted=u._muted||i.muted,i.volume=r._volume*u.volume(),setTimeout(function(){i.play()},0)}return r.on("play"),"function"==typeof n&&n(l),r}),r):("function"==typeof n&&n(),r):(r.on("load",function(){r.play(e,n)}),r)},pause:function(e){var t=this;if(!t._loaded)return t.on("play",function(){t.pause(e)}),t;t._clearEndTimer(e);var n=e?t._nodeById(e):t._activeNode();if(n)if(n._pos=t.pos(null,e),t._webAudio){if(!n.bufferSource||n.paused)return t;n.paused=!0,void 0===n.bufferSource.stop?n.bufferSource.noteOff(0):n.bufferSource.stop(0)}else n.pause();return t.on("pause"),t},stop:function(e){var t=this;if(!t._loaded)return t.on("play",function(){t.stop(e)}),t;t._clearEndTimer(e);var n=e?t._nodeById(e):t._activeNode();if(n)if(n._pos=0,t._webAudio){if(!n.bufferSource||n.paused)return t;n.paused=!0,void 0===n.bufferSource.stop?n.bufferSource.noteOff(0):n.bufferSource.stop(0)}else isNaN(n.duration)||(n.pause(),n.currentTime=0);return t},mute:function(e){var t=this;if(!t._loaded)return t.on("play",function(){t.mute(e)}),t;var n=e?t._nodeById(e):t._activeNode();return n&&(t._webAudio?n.gain.value=0:n.muted=!0),t},unmute:function(e){var t=this;if(!t._loaded)return t.on("play",function(){t.unmute(e)}),t;var n=e?t._nodeById(e):t._activeNode();return n&&(t._webAudio?n.gain.value=t._volume:n.muted=!1),t},volume:function(e,t){var n=this;if(e=parseFloat(e),e>=0&&1>=e){if(n._volume=e,!n._loaded)return n.on("play",function(){n.volume(e,t)}),n;var r=t?n._nodeById(t):n._activeNode();return r&&(n._webAudio?r.gain.value=e:r.volume=e*u.volume()),n}return n._volume},loop:function(e){var t=this;return"boolean"==typeof e?(t._loop=e,t):t._loop},sprite:function(e){var t=this;return"object"==typeof e?(t._sprite=e,t):t._sprite},pos:function(e,n){var r=this;if(!r._loaded)return r.on("load",function(){r.pos(e)}),"number"==typeof e?r:r._pos||0;e=parseFloat(e);var i=n?r._nodeById(n):r._activeNode();if(i)return e>=0?(r.pause(n),i._pos=e,r.play(i._sprite,n),r):r._webAudio?i._pos+(t.currentTime-r._playStart):i.currentTime;if(e>=0)return r;for(var s=0;s<r._audioNode.length;s++)if(r._audioNode[s].paused&&4===r._audioNode[s].readyState)return r._webAudio?r._audioNode[s]._pos:r._audioNode[s].currentTime},pos3d:function(e,t,n,r){var i=this;if(t=void 0!==t&&t?t:0,n=void 0!==n&&n?n:-.5,!i._loaded)return i.on("play",function(){i.pos3d(e,t,n,r)}),i;if(!(e>=0||0>e))return i._pos3d;if(i._webAudio){var s=r?i._nodeById(r):i._activeNode();s&&(i._pos3d=[e,t,n],s.panner.setPosition(e,t,n),s.panner.panningModel=i._model||"HRTF")}return i},fade:function(e,t,n,r,i){var s=this,o=Math.abs(e-t),u=e>t?"down":"up",a=o/.01,f=n/a;if(!s._loaded)return s.on("load",function(){s.fade(e,t,n,r,i)}),s;s.volume(e,i);for(var l=1;a>=l;l++)!function(){var e=s._volume+("up"===u?.01:-.01)*l,n=Math.round(1e3*e)/1e3,o=t;setTimeout(function(){s.volume(n,i),n===o&&r&&r()},f*l)}()},fadeIn:function(e,t,n){return this.volume(0).play().fade(0,e,t,n)},fadeOut:function(e,t,n,r){var i=this;return i.fade(i._volume,e,t,function(){n&&n(),i.pause(r),i.on("end")},r)},_nodeById:function(e){for(var t=this,n=t._audioNode[0],r=0;r<t._audioNode.length;r++)if(t._audioNode[r].id===e){n=t._audioNode[r];break}return n},_activeNode:function(){for(var e=this,t=null,n=0;n<e._audioNode.length;n++)if(!e._audioNode[n].paused){t=e._audioNode[n];break}return e._drainPool(),t},_inactiveNode:function(e){for(var t=this,n=null,r=0;r<t._audioNode.length;r++)if(t._audioNode[r].paused&&4===t._audioNode[r].readyState){e(t._audioNode[r]),n=!0;break}if(t._drainPool(),!n){var i;if(t._webAudio)i=t._setupAudioNode(),e(i);else{t.load(),i=t._audioNode[t._audioNode.length-1];var s=navigator.isCocoonJS?"canplaythrough":"loadedmetadata",o=function(){i.removeEventListener(s,o,!1),e(i)};i.addEventListener(s,o,!1)}}},_drainPool:function(){var e,t=this,n=0;for(e=0;e<t._audioNode.length;e++)t._audioNode[e].paused&&n++;for(e=t._audioNode.length-1;e>=0&&!(5>=n);e--)t._audioNode[e].paused&&(t._webAudio&&t._audioNode[e].disconnect(0),n--,t._audioNode.splice(e,1))},_clearEndTimer:function(e){for(var t=this,n=0,r=0;r<t._onendTimer.length;r++)if(t._onendTimer[r].id===e){n=r;break}var i=t._onendTimer[n];i&&(clearTimeout(i.timer),t._onendTimer.splice(n,1))},_setupAudioNode:function(){var e=this,n=e._audioNode,r=e._audioNode.length;return n[r]=void 0===t.createGain?t.createGainNode():t.createGain(),n[r].gain.value=e._volume,n[r].paused=!0,n[r]._pos=0,n[r].readyState=4,n[r].connect(s),n[r].panner=t.createPanner(),n[r].panner.panningModel=e._model||"equalpower",n[r].panner.setPosition(e._pos3d[0],e._pos3d[1],e._pos3d[2]),n[r].panner.connect(n[r]),n[r]},on:function(e,t){var n=this,r=n["_on"+e];if("function"==typeof t)r.push(t);else for(var i=0;i<r.length;i++)t?r[i].call(n,t):r[i].call(n);return n},off:function(e,t){for(var n=this,r=n["_on"+e],i=""+t,s=0;s<r.length;s++)if(i===""+r[s]){r.splice(s,1);break}return n},unload:function(){for(var t=this,n=t._audioNode,r=0;r<t._audioNode.length;r++)n[r].paused||t.stop(n[r].id),t._webAudio?n[r].disconnect(0):n[r].src="";for(r=0;r<t._onendTimer.length;r++)clearTimeout(t._onendTimer[r].timer);var i=u._howls.indexOf(t);null!==i&&i>=0&&u._howls.splice(i,1),delete e[t._src],t=null}},n)var c=function(n,r){if(r in e)n._duration=e[r].duration,h(n);else{var i=new XMLHttpRequest;i.open("GET",r,!0),i.responseType="arraybuffer",i.onload=function(){t.decodeAudioData(i.response,function(t){t&&(e[r]=t,h(n,t))},function(){n.on("loaderror")})},i.onerror=function(){n._webAudio&&(n._buffer=!0,n._webAudio=!1,n._audioNode=[],delete n._gainNode,n.load())};try{i.send()}catch(s){i.onerror()}}},h=function(e,t){e._duration=t?t.duration:e._duration,0===Object.getOwnPropertyNames(e._sprite).length&&(e._sprite={_default:[0,1e3*e._duration]}),e._loaded||(e._loaded=!0,e.on("load")),e._autoplay&&e.play()},p=function(n,r,i){var s=n._nodeById(i);s.bufferSource=t.createBufferSource(),s.bufferSource.buffer=e[n._src],s.bufferSource.connect(s.panner),s.bufferSource.loop=r[0],r[0]&&(s.bufferSource.loopStart=r[1],s.bufferSource.loopEnd=r[1]+r[2]),s.bufferSource.playbackRate.value=n._rate};"function"==typeof define&&define.amd&&define(function(){return{Howler:u,Howl:l}}),"undefined"!=typeof exports&&(exports.Howler=u,exports.Howl=l),"undefined"!=typeof window&&(window.Howler=u,window.Howl=l)}();
var djinn = {
	manifest: {"title":"Bats","shortName":"bats","launch":"js/Bats","port":8832,"size":[1280,720],"buildNumber":1},
	platform: ""
};

/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

(function(){var e,t,n;(function(r){function v(e,t){return h.call(e,t)}function m(e,t){var n,r,i,s,o,u,a,f,c,h,p,v=t&&t.split("/"),m=l.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,l.nodeIdCompat&&d.test(e[o])&&(e[o]=e[o].replace(d,"")),e=v.concat(e);for(c=0;c<e.length;c+=1){p=e[c];if(p===".")e.splice(c,1),c-=1;else if(p===".."){if(c===1&&(e[2]===".."||e[0]===".."))break;c>0&&(e.splice(c-1,2),c-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(c=n.length;c>0;c-=1){r=n.slice(0,c).join("/");if(v)for(h=v.length;h>0;h-=1){i=m[v.slice(0,h).join("/")];if(i){i=i[r];if(i){s=i,u=c;break}}}if(s)break;!a&&g&&g[r]&&(a=g[r],f=c)}!s&&a&&(s=a,u=f),s&&(n.splice(0,u,s),e=n.join("/"))}return e}function g(e,t){return function(){return s.apply(r,p.call(arguments,0).concat([e,t]))}}function y(e){return function(t){return m(t,e)}}function b(e){return function(t){a[e]=t}}function w(e){if(v(f,e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!v(a,e)&&!v(c,e))throw new Error("No "+e);return a[e]}function E(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function S(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice,d=/\.js$/;o=function(e,t){var n,r=E(e),i=r[0];return e=r[1],i&&(i=m(i,t),n=w(i)),i?n&&n.normalize?e=n.normalize(e,y(t)):e=m(e,t):(e=m(e,t),r=E(e),i=r[0],e=r[1],i&&(n=w(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return g(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:S(e)}}},i=function(e,t,n,i){var s,l,h,p,d,m=[],y=typeof n,E;i=i||e;if(y==="undefined"||y==="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(d=0;d<t.length;d+=1){p=o(t[d],i),l=p.f;if(l==="require")m[d]=u.require(e);else if(l==="exports")m[d]=u.exports(e),E=!0;else if(l==="module")s=m[d]=u.module(e);else if(v(a,l)||v(f,l)||v(c,l))m[d]=w(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,g(i,!0),b(l),{}),m[d]=a[l]}}h=n?n.apply(a[e],m):undefined;if(e)if(s&&s.exports!==r&&s.exports!==a[e])a[e]=s.exports;else if(h!==r||!E)a[e]=h}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){if(typeof e=="string")return u[e]?u[e](t):w(o(e,t).f);if(!e.splice){l=e,l.deps&&s(l.deps,l.callback);if(!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},typeof n=="function"&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),s},s.config=function(e){return s(e)},e._defined=a,n=function(e,t,n){t.splice||(n=t,t=[]),!v(a,e)&&!v(f,e)&&(f[e]=[e,t,n])},n.amd={jQuery:!0}})(),n("../djinn/lib/require/almond-0.2.9",function(){}),n("djinn/utils/pool",["require","exports","module"],function(e,t,n){var r={};t.create=function(e){if(r[e])return;r[e]=[]},t.get=function(e){return t.create(e),r[e].length>0?r[e].pop():null},t.put=function(e,n){t.create(e),r[e].push(n)}}),n("djinn/Class",["require","exports","module","./utils/pool"],function(e,t,n){var r=e("./utils/pool"),i=function(){var e=Object.create(this.prototype);return this.apply(e,arguments),e},s=function(){},o=0,u=!1,a=/\b_super\b/,f=function(){};return f.uid=0,f.extend=function(e){var t=this.prototype;u=!0;var n=new this;u=!1;for(var r in e)n[r]=typeof e[r]=="function"&&typeof t[r]=="function"&&a.test(e[r])?function(e,n){return function(){var r=this._super;this._super=t[e];var i=n.apply(this,arguments);return this._super=r,i}}(r,e[r]):e[r];var s=function(){!u&&this.init&&this.init.apply(this,arguments)};return s.prototype=n,s.prototype.constructor=s,s.extend=arguments.callee,s.create=i,s.uid="Class_"+String(++o),s},f.prototype.dispose=s,f}),n("djinn/Emitter",["require","exports","module","./Class"],function(e,t,n){var r=e("./Class");n.exports=r.extend({init:function(e){var e=e||{};this._listenerKey=0,this._listeners={}},dispose:function(){this.removeListeners(),this._super()},fire:function(e,t){for(var n in this._listeners){var r=this._listeners[n];if(r.eventName==e)if(r.method)r.method.apply(r.context,t);else if(r.methodName){var i=r.context[r.methodName];if(typeof i!="function")throw"Could not find method: "+r.methodName;i.apply(r.context,t)}}},on:function(e){var t={eventName:e};if(arguments.length==2)t.method=arguments[1];else{t.context=arguments[1];var n=arguments[2];typeof n=="string"?t.methodName=n:t.method=n}return this._listeners[++this._listenerKey]=t,this},removeListeners:function(){for(var e in this._listeners)delete this._listeners[e];this._listeners={}},removeListenersByContext:function(e){for(var t in this._listeners){var n=this._listeners[t];n.context===e&&delete this._listeners[t]}},off:function(e){var t=null;for(var n in this._listeners){var r=this._listeners[n];if(r.eventName==e)if(arguments.length==2){if(r.method==arguments[1]){t=n;break}}else{var i=arguments[1];if(i==r.context){var s=arguments[2];if(typeof s=="string"){if(s==r.methodName){t=n;break}}else{r.method=s;if(s==r.method){t=n;break}}}}}return t!==null&&delete this._listeners[t],this},remove:function(){this._listeners=null}})}),n("djinn/manifest",["require","exports","module"],function(e,t,n){n.exports=djinn.manifest}),n("djinn/utils/string",["require","exports","module"],function(e,t,n){t.sprintf=function(){var e=arguments[0],t=arguments.length;for(var n=1;n<t;++n)e=e.replace(/%s/,arguments[n]);return e},t.parseNumber=function(e){return Number(e.replace(/([^0-9\.])/g,""))},t.formatNumber=function(e){var e=String(e),t=e.split("."),n=t[0],r=t.length>1?"."+t[1]:"",i=/(\d+)(\d{3})/;while(i.test(n))n=n.replace(i,"$1,$2");return n+r},t.formatOrdinalNumber=function(e){var e=String(e),t="";switch(e.slice(-1)){case"1":t="st";break;case"2":t="nd";break;case"3":t="rd";break;default:t="th"}return e+t},t.formatTime=function(e){var n=~~(e/1e3)%60,r=~~(e/6e4)%60,i=~~(e/36e5)%24;return n<10&&(n="0"+n),r<10&&(r="0"+r),i>0?t.sprintf("%s:%s:%s",i,r,n):t.sprintf("%s:%s",r,n)},t.ucfirst=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},t.hashCharCode=function(e){var t=0;if(e.length<1)return t;for(i=0,j=e.length;i<j;i++){var n=e.charCodeAt(i);t=(t<<5)-t+n,t|=0}return Math.abs(t)}}),n("djinn/client",["require","exports","module","djinn/Emitter","djinn/manifest","djinn/utils/string"],function(e,t,n){var r=e("djinn/Emitter"),i=e("djinn/manifest"),s=e("djinn/utils/string"),t=r.extend({init:function(e){this._super(e),this.debug=!1,this._detectEnvironment(),this._updateSize();if(this.isTouch){var t=bind(this,function(e){e.preventDefault()}),n=["touchstart","touchmove","touchend"];for(var r=0,i=n.length;r<i;++r)addEventListener(n[r],t,!1)}var s=bind(this,"_updateSize");window.addEventListener("resize",s,!1),window.addEventListener("orientationchange",s,!1),window.addEventListener("DOMContentLoaded",s,!1),window.addEventListener("load",bind(this,"_onLoad"),!1),this._initVisibilityChange(),window.addEventListener("tizenhwkey",bind(this,"_onTizenHardwareKey"),!1)},isNative:function(){return Boolean(window.nw)},enterFullscreen:function(){this._nwWindow&&this._nwWindow.enterFullscreen()},toggleFullscreen:function(){this._nwWindow&&this._nwWindow.toggleFullscreen()},open:function(e){window.nw&&window.nw.gui?window.nw.gui.Shell.openExternal(e):location.href=e},quit:function(){window.nw&&window.nw.gui&&window.nw.gui.App.quit()},vibrate:function(e){if(!navigator.vibrate)return;navigator.vibrate(e)},log:function(){if(arguments.length>1)var e=s.sprintf.apply(null,arguments);else var e=arguments[0];console.log(e)},_detectEnvironment:function(){var e=this.userAgent=navigator.userAgent;this.pixelRatio=window.devicePixelRatio||1,this.isTouch=typeof window.ontouchstart!="undefined"||!this.isBrowser,this.isIPhone=/iPhone OS/.test(e),this.isIPad=/iPad/.test(e),this.isIOS=this.isIPhone||this.isIPad,this.isAndroid=/Android/.test(e),this._nwWindow=null;if(window.nw&&window.nw.gui){var t=this._nwWindow=window.nw.gui.Window.get(),n=bind(this,"_onFullscreenChange");t.on("enter-fullscreen",n),t.on("leave-fullscreen",n)}this.debug&&(this.log("[client._detectEnvironment] Debugging info:"),this.log("User Agent: %s",this.userAgent),this.log("Device: %s",this.deviceType),this.log("Pixel Ratio: %s",this.pixelRatio))},_queryWindowSize:function(){var e={width:~~window.innerWidth,height:~~window.innerHeight};return e},_updateSize:function(){var e=this._queryWindowSize();if(e.width!==this.width||e.height!==this.height)this.width=e.width,this.height=e.height,this.debug&&this.log("[client._updateSize] %sx%s",this.width,this.height),this.fire("resize",[this.width,this.height,this.orientation])},_onLoad:function(){this._updateSize(),this.isAndroid&&setInterval(bind(this,"_updateSize"),500)},_initVisibilityChange:function(){var e=null;this._hiddenPropertyName=null,typeof document.hidden!="undefined"?(e="visibilitychange",this._hiddenPropertyName="hidden"):typeof document.webkitHidden!="undefined"?(e="webkitvisibilitychange",this._hiddenPropertyName="webkitHidden"):typeof document.mozHidden!="undefined"?(e="mozvisibilitychange",this._hiddenPropertyName="mozHidden"):typeof document.msHidden!="undefined"&&(e="msvisibilitychange",this._hiddenPropertyName="msHidden");if(!e)return;document.addEventListener(e,bind(this,"_onVisibilityChange"),!1)},_onVisibilityChange:function(){this.fire("visibilityChange",[this.hidden])},_onFullscreenChange:function(){this.fire("fullscreenChange",[this.fullscreen])},_onTizenHardwareKey:function(e){if(e.keyName)var t=e.keyName;else if(e.originalEvent&&e.originalEvent.keyName)var t=e.originalEvent.keyName;else var t=null;switch(t){case"back":tizen.application.getCurrentApplication().exit()}}});Object.defineProperty(t.prototype,"orientation",{get:function(){var e=this.width>=this.height?"landscape":"portrait";return isNaN(window.orientation)&&i.orientation!=="both"?i.orientation:e}}),Object.defineProperty(t.prototype,"hidden",{get:function(){return this._hiddenPropertyName?document[this._hiddenPropertyName]:!1}}),Object.defineProperty(t.prototype,"fullscreen",{get:function(){if(this._nwWindow)return this._nwWindow.isFullscreen}}),Object.defineProperty(t.prototype,"deviceType",{get:function(){return this.isAndroid?"Android":this.isIPhone?"iPhone":this.isIPad?"iPad":"Unknown"}}),Object.defineProperty(t.prototype,"isBrowser",{get:function(){return document&&typeof document.querySelectorAll=="function"&&!this.isCocoonJS}}),Object.defineProperty(t.prototype,"isCocoonJS",{get:function(){return navigator.isCocoonJS}}),Object.defineProperty(t.prototype,"isSteam",{get:function(){return djinn.platform==="steam"}}),n.exports=new t}),n("djinn/math/core",["require","exports","module"],function(e,t,n){t.twoPi=Math.PI*2,t.sign=function(e){return e>0?1:e==0?0:-1},t.clamp=function(e,t,n){return Math.min(Math.max(e,t),n)},t.round=function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n},t.normalize=function(e,t,n){return(e-t)/(n-t)},t.map=function(e,n,r,i,s){return t.lerp(i,s,t.normalize(e,n,r))},t.lerp=function(e,t,n,r){var i=e+(t-e)*n;return r?Math.round(i):i},t.distance=function(e,t,n,r){return Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2))},t.random=function(e,t){return e instanceof Array?arguments.callee(0,e.length-1):Math.round(Math.random()*(t-e))+e},t.intersects=function(e,t){return e.x<t.x+t.width&&t.x<e.x+e.width&&e.y<t.y+t.height&&t.y<e.y+e.height},t.pointInCircle=function(e,t,n,r,i){var s=Math.pow(e-n,2)+Math.pow(t-r,2);return s<Math.pow(i,2)},t.pointDistance=function(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}}),n("djinn/utils/request",["require","exports","module","../client"],function(e,t,n){var r=e("../client");t.params={},r.isBrowser&&location.href.replace(/[?&]+([^=&]+)=([^&#]*)/gi,function(e,n,r){t.params[n]=r})}),n("djinn/stage",["require","exports","module","./Emitter","./client","./math/core","./manifest","./utils/string","./utils/request"],function(e,t,n){var r=e("./Emitter"),i=e("./client"),s=e("./math/core"),o=e("./manifest"),u=e("./utils/string"),a=e("./utils/request"),f=[],l=!1,c=["touchstart","touchmove","touchend"],h=["mousedown","mousemove","mouseup"],p=r.extend({init:function(e){this._super(e),this.eraseBeforeRender=!1,this._maxScale=Infinity,this.maintainAspectRatio=o.scaleMode!=="stretch",this.doubleBuffer=!1,this._buffer=null,this._bufferCtx=null,this.acceptInput=!1,this.xInput=0,this.yInput=0,this.inputDown=!1,this.viewportWidth=0,this.viewportHeight=0,this.canvas=null,this.ctx=null,this.xScale=1,this.yScale=1,i.isTizen&&(this.doubleBuffer=!0,this.eraseBeforeRender=!0);var t=this.isCocoonJS?"screencanvas":"canvas",n=this.canvas=document.createElement(t);n.width=o.size[0],n.height=o.size[1],i.isBrowser&&(n.style.position="absolute",n.style.left=0,n.style.top=0),document.body.appendChild(n),this._initInput(),this.ctx=n.getContext("2d"),this._autoSize(),i.on("resize",this,"_autoSize")},localizePoint:function(e,t){return{x:Math.round((e-this.canvas.offsetLeft)*(1/this.xScale)),y:Math.round((t-this.canvas.offsetTop)*(1/this.yScale))}},renderView:function(e){var t=this.canvas,n=this.ctx;this.eraseBeforeRender&&n.clearRect(0,0,t.width,t.height);if(this.doubleBuffer){this._buffer||(this._buffer=this.createBuffer(t.width,t.height),this._bufferCtx=this._buffer.getContext("2d"));var r=this._buffer;this.eraseBeforeRender&&this._bufferCtx.clearRect(0,0,r.width,r.height),e.preRender(this._bufferCtx),n.drawImage(r,0,0,r.width,r.height,0,0,t.width,t.height)}else e.preRender(n)},createBuffer:function(e,t){var n=document.createElement("canvas");return n.width=Number(e),n.height=Number(t),n},getInputEvents:function(){var e=f;return f=[],e},requestFullScreen:function(){document.body.webkitRequestFullScreen()},cancelFullScreen:function(){document.webkitCancelFullScreen()},toggleFullScreen:function(){if(!this.canFullScreen)return;this.isFullScreen?this.cancelFullScreen():this.requestFullScreen()},setViewport:function(e,t){this.viewportWidth=e,this.viewportHeight=t,this._autoSize()},_getEventType:function(e){switch(e.type){case"touchstart":case"mousedown":return"inputStart";case"touchmove":case"mousemove":return"inputMove";case"touchend":case"mouseup":return"inputEnd"}},_handleInputEvent:function(e){if(!this.acceptInput)return;var t=-1,n=0,r=0;if(i.isTouch){var s=e.type==="touchend"?e.changedTouches[0]:e.touches[0];t=s.identifier,n=s.pageX,r=s.pageY}else n=e.pageX,r=e.pageY;var o={id:t,type:this._getEventType(e),point:this.localizePoint(n,r)};this.xInput=o.point.x,this.yInput=o.point.y,this.inputDown=o.type!=="inputEnd",f.push(o),this.fire(o.type,[o]),this.fire("input",[o]),l||(l=!0,this.fire("initialInput"))},_initInput:function(){var e=this.canvas,t=i.isTouch?c:h;for(var n=0,r=t.length;n<r;++n)e.addEventListener(t[n],bind(this,"_handleInputEvent"),!1)},_autoSize:function(){var e=this.canvas,t=Math.min(e.width,e.height),n=Math.max(e.width,e.height),r=o.orientation!=="both"&&o.forceOrientation,f=r?o.orientation:i.orientation;e.width=f=="portrait"?t:n,e.height=f=="portrait"?n:t;var l=this.viewportWidth||i.width,c=this.viewportHeight||i.height,h=l/e.width,p=c/e.height;i.isCocoonJS?(this.xScale=this.yScale=1,e.style.cssText="idtkscale:ScaleAspectFit;"):a.params.scale?this.xScale=this.yScale=Number(a.params.scale):this.maintainAspectRatio?this.xScale=this.yScale=Math.min(h,p):(this.xScale=h,this.yScale=p),i.log("[stage._autoSize] view: %sx%s, canvas: %sx%s, scale: %s, %s",l,c,e.width,e.height,s.round(this.xScale,3),s.round(this.yScale,3));var d="0 0";if(i.isIOS)var v=u.sprintf("scale3d(%s, %s, 1)",this.xScale,this.yScale);else var v=u.sprintf("scale(%s, %s)",this.xScale,this.yScale);if(i.isBrowser){var m=e.style;m.transformOrigin=d,m.transform=v;var g=["webkit","Moz","ms"];for(var y=0,b=g.length;y<b;++y){var w=g[y];m[w+"TransformOrigin"]=d,m[w+"Transform"]=v}m.left=i.width/2-e.width*this.xScale/2+"px",o.yStageAlign==="top"?m.top=0:m.top=i.height/2-e.height*this.yScale/2+"px"}this.fire("resize")}}),d=p.prototype;Object.defineProperty(d,"canFullScreen",{get:function(){return typeof document.webkitCancelFullScreen=="function"}}),Object.defineProperty(d,"isFullScreen",{get:function(){return document.webkitIsFullScreen}}),Object.defineProperty(d,"maxScale",{get:function(){return this._maxScale},set:function(e){this._maxScale=e,this._autoSize()}}),Object.defineProperty(d,"width",{get:function(){return this.canvas.width}}),Object.defineProperty(d,"height",{get:function(){return this.canvas.height}}),Object.defineProperty(d,"scaleWidth",{get:function(){return this.width*this.xScale}}),Object.defineProperty(d,"scaleHeight",{get:function(){return this.height*this.yScale}}),n.exports=new p}),n("djinn/assets",["djinn/client","djinn/manifest","djinn/utils/string"],function(e,t,n){var r={},i={image:["png","jpg","jpeg","gif"],audio:["mp3"],font:["ttf"]},s={image:function(n,r,i){var s=new Image;s.onload=function(){s.ready=!0,r&&r(n,s)},s.onerror=function(){i&&i(n,s)};if(e.isBrowser&&n.substring(0,5)!="data:")var n=n+"?v="+t.version;return s.src=n,s},audio:function(t,n){if(typeof Audio=="undefined")return logger.warn("[assets] No Audio object: "+t),n&&n(t,null),null;var r=new Audio;if(r.canPlayType("audio/ogg")!=="")t=t.replace(/\.mp3/,".ogg");else if(r.canPlayType("audio/mpeg")==="")return logger.warn("[assets] No audio support: "+t),n&&n(t,null),null;return e.isBrowser?(r.addEventListener("canplay",function(){if(r.ready)return;r.ready=!0,n&&n(t,r)},!1),r.src=t):(r.addEventListener("canplaythrough",function(){r.ready=!0,n&&n(t,r)}),r.src=t,r.load()),r},font:function(t,r){if(e.isBrowser){var i=/^.*\/([^\.]+)\.ttf$/.exec(t),s=i[1],o=n.sprintf("@font-face { font-family: '%s'; src: url('%s'); }",s,t),u=document.createElement("style");u&&(u.innerHTML=o,document.head.appendChild(u))}return r&&r(t,null),null}},o={};return o.cacheImage=function(e,t){r[e]=s.image(t)},o.load=function(e,t,n){if(!e||e.length<1){n&&n(null,null,0,0,1),t&&t();return}typeof e=="string"&&(e=[e]);var i=e.length,u=0,a=function(e,s){r[e]=s,++u;var o=u/i;n&&n(e,s,u,i,o),u>=i&&t&&t()},f=function(e,t){logger.error("[assets.load] Failed to load asset: "+e),a(e,t)};for(var l=0,c=e.length;l<c;++l){var h=e[l];if(typeof h!="string"||h.length<=0)--i,logger.info("[assets.load] Skipping empty asset path");if(r[h])a(h,r[h]);else{var p=o.inferAssetType(h);if(p&&s[p]){var d=s[p];r[h]=d(h,a,f)}else--i,logger.info("[assets.load] Skipping unknown asset type: "+h)}}},o.unload=function(e){typeof e=="string"&&(e=[e]);for(var t=0,n=e.length;t<n;++t)delete r[e[t]]},o.queryCache=function(e){return r[e]!==undefined},o.get=function(e){return o.queryCache(e)||(logger.warn("[assets.get] On-the-fly asset load: "+e),o.load(e)),r[e]},o.inferAssetType=function(e){var t=e.split("."),n=t.length>0?t.pop():"";for(var r in i)if(i[r].indexOf(n)!=-1)return r;return null},o}),n("djinn/utils/array",["djinn/math/core"],function(e){var t={isArray:function(e){return e?typeof e.unshift=="function":!1},force:function(e){return t.isArray(e)?e:[e]},contains:function(e,t){return e.indexOf(t)!==-1},containsAny:function(e,n){for(var r=0,i=n.length;r<i;++r)if(t.contains(e,n[r]))return!0;return!1},removeValue:function(e,t){var n=e.indexOf(t);if(n===-1)return;e.splice(n,1)},removeIndices:function(e,t){t.length>1&&t.sort(function(e,t){return t-e});for(var n=0,r=t.length;n<r;++n)e.splice(t[n],1)},addItems:function(e,t,n){for(var r=0,i=t.length;r<i;++r){var s=t[r];if(n&&e.indexOf(s)!==-1)continue;e.push(s)}},pushOnce:function(e,t){if(e.indexOf(t)!==-1)return;e.push(t)},pickRandom:function(t){var n=e.random(0,t.length-1);return t[n]},popRandom:function(t){var n=e.random(0,t.length-1),r=t[n];return t.splice(n,1),r},merge:function(e,t,n){var r=[];while(e.length>0&&t.length>0)n(e[0],t[0])<=0?r.push(e.shift()):r.push(t.shift());return r.concat(e,t)},sort:function(e,n){var r=e.length;if(r<2)return e;var i=Math.ceil(r/2);return t.merge(t.sort(e.slice(0,i),n),t.sort(e.slice(i),n),n)},shuffle:function(e){var t=e.length;if(t<1)return;while(--t){var n=Math.floor(Math.random()*(t+1)),r=e[n];e[n]=e[t],e[t]=r}return e},max:function(e){var t=e[0]||0;for(var n=0,r=e.length;n<r;++n)t=Math.max(e[n],t);return t},sum:function(e){var t=0;for(var n=0,r=e.length;n<r;++n){if(isNaN(e[n]))continue;t+=e[n]}return t},last:function(e){return e[t.lastIndex(e)]},lastIndex:function(e){return e.length-1}};return t}),n("djinn/input/keys",["require","exports","module"],function(e,t,n){n.exports={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capsLock:20,escape:27,space:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,del:46,n0:48,n1:49,n2:50,n3:51,n4:52,n5:53,n6:54,n7:55,n8:56,n9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,leftWindow:91,rightWindow:92,select:93,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,decimalPoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numLock:144,scrollLock:145,semicolon:186,equal:197,comma:188,dash:189,period:190,slash:191,grave:192,openBracket:219,backSlash:220,closeBracket:221,quote:222}}),n("djinn/input/keyboard",["require","exports","module","../Emitter","../utils/array","./keys"],function(e,t,n){var r=e("../Emitter"),i=e("../utils/array"),s=e("./keys"),o=r.extend({init:function(e){this._super(e),this._capture=[],this.binds={},this.keys=s,this._keysDown={},this._keyHistory=[],this._lastKeysDown={},this._shiftDown=!1,this.bind({up:["up","w"],left:["left","a"],down:["down","s"],right:["right","d"],accept:["enter","space"],negate:["escape"]}),window.addEventListener("keydown",bind(this,"_handleKeyEvent"),!1),window.addEventListener("keyup",bind(this,"_handleKeyEvent"),!1)},bind:function(e){var t=this.binds;for(var n in e){var r=t[n]=[],o=i.force(e[n]);o.forEach(function(e){r.push(s[e])}),this.capture(r)}},test:function(e,t){var n=this.binds[e];return n?this.isDown(n,t):!1},capture:function(e){var t=this._capture;e.forEach(function(e){if(t.indexOf(e)!==-1)return;t.push(e)})},endFrame:function(){this._lastKeysDown={};for(var e in this._keysDown)this._lastKeysDown[e]=this._keysDown[e]},checkHistory:function(e){var t=e.length,n=this._keyHistory.slice(-t);if(n.length!=t)return!1;for(var r=0;r<t;r++)if(e[r]!==n[r])return!1;return!0},clearHistory:function(){this._keyHistory=[]},isDown:function(e,t){i.isArray(e)||(e=[e]);for(var n=0,r=e.length;n<r;++n)if(this._keysDown[e[n]])if(t!==!0||this._lastKeysDown[e[n]]!==!0)return!0;return!1},isShiftDown:function(){return this._shiftDown},isAnyDown:function(){for(var e in this._keysDown)return!0;return!1},clearKeys:function(e){var e=i.force(e);for(var t=0,n=e.length;t<n;++t)delete this._keysDown[e[t]]},getKeyAliasByCode:function(e){for(var t in s)if(e===s[t])return t;return null},_handleKeyEvent:function(e){this._capture.indexOf(e.keyCode)!==-1&&e.preventDefault(),e.type==="keydown"?(this._keysDown[e.keyCode]=!0,this._keyHistory.push(e.keyCode),this._keyHistory.length>50&&this._keyHistory.shift(),this.fire("keyDown",[e.keyCode])):e.type==="keyup"&&delete this._keysDown[e.keyCode],this._shiftDown=e.shiftKey}});n.exports=new o}),n("djinn/input/buttons",{dPadUp:12,dPadDown:13,dPadLeft:14,dPadRight:15,face1:0,face2:1,face3:2,face4:3,a:0,b:1,x:2,y:3,shoulderTopLeft:4,shoulderTopRight:5,shoulderBottomLeft:6,shoulderBottomRight:7,select:8,start:9,analogLeft:10,analogRight:11}),n("djinn/input/gamepad",["require","exports","module","../Emitter","../utils/array","./buttons"],function(e,t,n){var r=e("../Emitter"),i=e("../utils/array"),s=e("./buttons"),o={up:function(e,t){return e.axes[1]<-t},down:function(e,t){return e.axes[1]>t},left:function(e,t){return e.axes[0]<-t},right:function(e,t){return e.axes[0]>t}},u=function(e){var t=navigator.getGamepads||navigator.webkitGetGamepads;if(!t)return null;var n=t.call(navigator),r=n[e||0];return r},a=r.extend({init:function(e){var e=merge(e,a.defaults);this._super(e),this.analogThreshold=e.analogThreshold,this.threshold=e.threshold,this.analogDeadZoneLeft=e.analogDeadZoneLeft,this.analogDeadZoneRight=e.analogDeadZoneRight,this.buttons=s,this._buttonsDown={},this._lastButtonsDown={},this._directionsDown={},this._lastDirectionsDown={}},exists:function(){return!!u()},endFrame:function(){this._lastButtonsDown={};for(var e in this._buttonsDown)this._lastButtonsDown[e]=this._buttonsDown[e];this._lastDirectionsDown={};for(var e in this._directionsDown)this._lastDirectionsDown[e]=this._directionsDown[e]},getAnalogData:function(e){var t={x:0,y:0,magnitude:0,magnitudeNormal:0},n=u();if(!n)return t;var r=n.axes,i=e==="left",s=i?this.analogDeadZoneLeft:this.analogDeadZoneRight,o=i?r[0]:r[2],a=i?r[1]:r[3],f=this.analogThreshold;Math.abs(o)<f&&(o=0),Math.abs(a)<f&&(a=0);var l=Math.sqrt(o*o+a*a),c=o/l,h=a/l;if(l>s){l=Math.min(l,1),l-=s;var p=l/(1-s);t.x=o,t.y=a,t.xNormal=c,t.yNormal=h,t.magnitude=l,t.magnitudeNormal=p}return t},clearButtons:function(e){var t=u();if(!t)return!1;var e=i.force(e);e.forEach(function(e){t.buttons[e]=!1},this)},isButtonDown:function(e,t){var n=u();if(!n)return!1;var r=n.buttons[e];if(r===undefined)return;var i=r;r.value&&(i=r.value);var s=i>this.threshold,o=s;return t&&(o=s&&!this._buttonsDown[e]),this._buttonsDown[e]=s,o},isDirectionDown:function(e,t){var n=u();if(!n)return!1;var r=o[e](n,this.threshold),i=r;return t&&(i=r&&!this._directionsDown[e]),this._directionsDown[e]=r,i}});a.defaults={threshold:.75,analogThreshold:.25,analogDeadZoneLeft:.3,analogDeadZoneRight:.3},n.exports=new a}),n("djinn/globalTimer",["djinn/Emitter"],function(e){var t=1e3,n=120,r=e.extend({init:function(e){this._super(e),this.running=!1,this.fps=0,this.deltaTime=0,this.deltaTimeAverage=0,this.tickCount=0,this._lastUpdate=0,this._tickHistory=[]},start:function(){this.running=!0,this._lastUpdate=Date.now(),this._requestFrame()},stop:function(){this.running=!1},_requestFrame:function(){this.running&&requestAnimationFrame(bind(this,"_update"))},_update:function(e){++this.tickCount;var n=e-this._lastUpdate;n>t?(logger.warn("[globalTimer] dropping large tick: ",n),n=1):n<0&&(logger.warn("[globalTimer] negative delta: ",n),n=1),this._recordTick(n),this.deltaTime=n,this.fire("tick",[n]),this._lastUpdate=e,this._requestFrame()},_recordTick:function(e){var t=this._tickHistory.push(e);if(t>n){var r=0;for(var i=0;i<t;++i)r+=this._tickHistory[i];this.deltaTimeAverage=r/t,this.fps=~~(1e3/this.deltaTimeAverage),this._tickHistory=[]}}});return new r}),n("djinn/Timer",["djinn/Emitter","djinn/globalTimer"],function(e,t){var n=e.extend({init:function(e){this._super(),this._elapsed=0,this._loops=0,this._running=!1,this._tickHost=t,typeof e=="number"?this.interval=e:typeof e=="object"?(this.interval=Number(e.interval||1e3),this._tickHost=e.tickHost||this._tickHost):this.interval=1e3},reset:function(){return this.start()},start:function(e){return e!==undefined&&(this.interval=e),this._elapsed=0,this.resume()},resume:function(){return this._running||(this._tickHost.on("tick",this,"_update"),this._running=!0),this},stop:function(){return this._running&&(this._tickHost.off("tick",this,"_update"),this._running=!1),this},_update:function(e){this._elapsed+=e,this._elapsed>=this.interval&&(this._elapsed=0,++this._loops,this.fire("elapsed",[this._loops]))}});return Object.defineProperty(n.prototype,"elapsed",{get:function(){return this._elapsed}}),Object.defineProperty(n.prototype,"percentComplete",{get:function(){return this._elapsed/this.interval*100}}),Object.defineProperty(n.prototype,"running",{get:function(){return this._running},set:function(e){e?this.start():this.stop()}}),n}),n("djinn/math/Vector2",["require","exports","module","../Class"],function(e,t,n){var r=e("../Class"),t=n.exports=r.extend({init:function(e){return e===undefined&&(e={x:0,y:0}),typeof e=="number"?(this.x=Number(e),this.y=Number(arguments[1])):e.angle===undefined?(this.x=Number(e.x||0),this.y=Number(e.y||0)):(this.x=e.magnitude*Math.cos(e.angle),this.y=e.magnitude*Math.sin(e.angle)),this},add:function(e){return this.x+=e.x,this.y+=e.y,this},clone:function(){return new this.constructor({x:this.x,y:this.y})},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},distance:function(e){return t.distance(this,e)},normalize:function(){var e=this.magnitude();return e===0?this:this.scale(1/e)},snap:function(e){var t=e*Math.round(this.heading/e);return this.x=Math.sin(t),this.y=-Math.cos(t),this},scale:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e,this.y/=e,this},subtract:function(e){return this.x-=e.x,this.y-=e.y,this},dot:function(e){return t.dot(this,e)},zero:function(){return this.x=0,this.y=0,this}}),i=t.prototype;Object.defineProperty(i,"angle",{get:function(){return Math.atan2(this.y,this.x)}}),Object.defineProperty(i,"heading",{get:function(){return Math.atan2(this.x,-this.y)}}),t.fromAngle=function(e){return t.create(Math.sin(e),-Math.cos(e))},t.makeFromHeading=function(e,n){var n=Number(n)||1;return new t({x:Math.sin(e)*n,y:-Math.cos(e)*n})},t.magnitude=function(e,t){return Math.sqrt(e*e+t*t)},t.distance=function(e,n){var r=t.subtract(n,e);return t.magnitude(r.x,r.y)},t.subtract=function(e,n){return new t(e.x-n.x,e.y-n.y)},t.dot=function(e,t){return e.x*t.x+e.y*t.y}}),n("djinn/math/Rectangle",["require","exports","module"],function(e,t,n){var t=n.exports=function(e,t,n,r){this.set(e,t,n,r)},r=t.prototype;r.set=function(e,t,n,r){return this.x=e,this.y=t,this.width=n,this.height=r,this},r.intersects=function(e){return t.intersects(this,e)},r.intersection=function(e,n){return t.intersection(this,e,n)},r.union=function(e,n){return t.union(this,e,n)},Object.defineProperty(r,"area",{get:function(){return this.width*this.height}}),Object.defineProperty(r,"left",{get:function(){return this.x}}),Object.defineProperty(r,"right",{get:function(){return this.x+this.width}}),Object.defineProperty(r,"top",{get:function(){return this.y}}),Object.defineProperty(r,"bottom",{get:function(){return this.y+this.height}}),Object.defineProperty(r,"halfWidth",{get:function(){return this.width/2}}),Object.defineProperty(r,"halfHeight",{get:function(){return this.height/2}}),Object.defineProperty(r,"centerX",{get:function(){return this.x+this.halfWidth}}),Object.defineProperty(r,"centerY",{get:function(){return this.y+this.halfHeight}}),t.intersects=function(e,t){return!(t.left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top)},t.intersection=function(e,n,r){return r||(r=new t),r.set(Math.max(e.x,n.x),Math.max(e.y,n.y),Math.min(e.right,n.right)-Math.max(e.x,n.x),Math.min(e.bottom,n.bottom)-Math.max(e.y,n.y))},t.union=function(e,n,r){return r||(r=new t),r.set(Math.min(e.x,n.x),Math.min(e.y,n.y),Math.max(e.right,n.right)-Math.max(e.left,n.left),Math.max(e.bottom,n.bottom)-Math.max(e.top,n.top))}}),n("djinn/math/collision",["require","exports","module","./Vector2","./Rectangle"],function(e,t,n){var r=e("./Vector2"),i=e("./Rectangle");t.testPointInRect=function(e,t){return e.x>t.x&&e.y>t.y&&e.x<t.x+t.width&&e.y<t.y+t.height},t.testAABB=function(e,t){var n={contacts:[],normal:{x:0,y:0},penetration:0},r={x:t.x+t.width/2-(e.x+e.width/2),y:t.y+t.height/2-(e.y+e.width/2)},i=(e.x+e.width-e.x)/2,s=(e.y+e.height-e.y)/2,o=(t.x+t.width-t.x)/2,u=(t.y+t.height-t.y)/2,a=i+o-Math.abs(r.x),f=s+u-Math.abs(r.y);return a<=0||f<=0?n:(n.contacts.push({x:Math.max(e.x,t.x),y:Math.max(e.y,t.y)}),n.contacts.push({x:Math.min(e.x+e.width,t.x+t.width),y:Math.min(e.y+e.height,t.y+t.height)}),a<f?(n.normal.x=r.x<0?1:-1,n.penetration=a):(n.normal.y=r.y<0?1:-1,n.penetration=f),n)}}),n("djinn/utils/transitions",[],function(){var e={linear:function(e,t,n,r){return n*e/r+t},easeIn:function(e,t,n,r){return n*(e/=r)*e+t},easeOut:function(e,t,n,r){return-n*(e/=r)*(e-2)+t},easeBoth:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},inStrong:function(e,t,n,r){return n*(e/=r)*e*e*e+t},outStrong:function(e,t,n,r){return-n*((e=e/r-1)*e*e*e-1)+t},bothStrong:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e*e+t:-n/2*((e-=2)*e*e*e-2)+t},elasticIn:function(e,t,n,r,i,s){if(e==0)return t;if((e/=r)==1)return t+n;s||(s=r*.3);if(!i||i<Math.abs(n)){i=n;var o=s/4}else var o=s/(2*Math.PI)*Math.asin(n/i);return-(i*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s))+t},elasticOut:function(e,t,n,r,i,s){if(e==0)return t;if((e/=r)==1)return t+n;s||(s=r*.3);if(!i||i<Math.abs(n)){i=n;var o=s/4}else var o=s/(2*Math.PI)*Math.asin(n/i);return i*Math.pow(2,-10*e)*Math.sin((e*r-o)*2*Math.PI/s)+n+t},elasticBoth:function(e,t,n,r,i,s){if(e==0)return t;if((e/=r/2)==2)return t+n;s||(s=r*.3*1.5);if(!i||i<Math.abs(n)){i=n;var o=s/4}else var o=s/(2*Math.PI)*Math.asin(n/i);return e<1?-0.5*i*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)+t:i*Math.pow(2,-10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)*.5+n+t},backIn:function(e,t,n,r,i){return i===undefined&&(i=1.70158),n*(e/=r)*e*((i+1)*e-i)+t},backOut:function(e,t,n,r,i){return i===undefined&&(i=1.70158),n*((e=e/r-1)*e*((i+1)*e+i)+1)+t},backBoth:function(e,t,n,r,i){return i===undefined&&(i=1.70158),(e/=r/2)<1?n/2*e*e*(((i*=1.525)+1)*e-i)+t:n/2*((e-=2)*e*(((i*=1.525)+1)*e+i)+2)+t},bounceIn:function(t,n,r,i){return r-e.bounceOut(i-t,0,r,i)+n},bounceOut:function(e,t,n,r){return(e/=r)<1/2.75?n*7.5625*e*e+t:e<2/2.75?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t},bounceBoth:function(t,n,r,i){return t<i/2?e.bounceIn(t*2,0,r,i)*.5+n:e.bounceOut(t*2-i,0,r,i)*.5+r*.5+n}};return e}),n("djinn/view/utils/canvas",["require","exports","module"],function(e,t,n){t.create=function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n},t.fillAndStroke=function(e,t,n,r){t&&(e.fillStyle=t,e.fill()),n&&r>0&&(e.lineWidth=r,e.strokeStyle=n,e.stroke())},t.drawRect=function(e,n,r,i,s,o,u,a,f){f>0?(e.beginPath(),e.moveTo(n+f,r),e.lineTo(n+i-f,r),e.quadraticCurveTo(n+i,r,n+i,r+f),e.lineTo(n+i,r+s-f),e.quadraticCurveTo(n+i,r+s,n+i-f,r+s),e.lineTo(n+f,r+s),e.quadraticCurveTo(n,r+s,n,r+s-f),e.lineTo(n,r+f),e.quadraticCurveTo(n,r,n+f,r),e.closePath(),t.fillAndStroke(e,o,u,a)):(o&&(e.fillStyle=o,e.fillRect(n,r,i,s)),u&&a>0&&(e.strokeStyle=u,e.lineWidth=a,e.strokeRect(n,r,i,s)))},t.drawCircle=function(e,n,r,i,s,o,u){e.beginPath(),e.arc(n,r,i,0,Math.PI*2),e.closePath(),t.fillAndStroke(e,s,o,u)},t.drawPolygon=function(e,n,r,i,s){e.beginPath(),e.moveTo(n[0],n[1]);for(var o=2,u=n.length;o<u;o+=2)e.lineTo(n[o],n[o+1]);e.closePath(),t.fillAndStroke(e,r,i,s)},t.drawText=function(e,t,n,r,i,s,o,u,a,f,l,c,h){e.font=i,a&&(e.textAlign=a),f&&(e.textBaseline=f),l&&(e.fillStyle=l,e.fillText(t,n+c,r+h)),o&&u>0&&(e.lineWidth=u*2,e.strokeStyle=o,e.strokeText(t,n,r)),s&&(e.fillStyle=s,e.fillText(t,n,r))},t.getTextWidth=function(e,t,n){e.font=n;var r=e.measureText(t);return r.width}}),n("djinn/view/View",["require","exports","module","../Emitter","../assets","../Timer","../stage","../math/collision","../utils/transitions","./utils/canvas"],function(e,t,n){var r=e("../Emitter"),i=e("../assets"),s=e("../Timer"),o=e("../stage"),u=e("../math/collision"),a=e("../utils/transitions"),f=e("./utils/canvas"),l=0,c=function(e,t){return e.z===t.z?e.id-t.id:e.z-t.z},t=n.exports=r.extend({init:function(e){var n=++l;e=merge(e,{id:n,tag:"View_"+n},t.defaults),e.parent&&(e.width=e.width||e.parent.width,e.height=e.height||e.parent.height),this._super(e),this.id=e.id,this.tag=e.tag,this.x=e.x,this.y=e.y,this.z=e.z,this.rotation=e.rotation,this.pivotX=e.pivotX,this.pivotY=e.pivotY,this.anchorX=e.anchorX,this.anchorY=e.anchorY,this.width=e.width,this.height=e.height,this.scaleX=e.scaleX,this.scaleY=e.scaleY,this.flipX=e.flipX,this.flipY=e.flipY,e.scale&&(this.scale=e.scale),this.visible=e.visible,this.opacity=e.opacity,this.clip=e.clip,this.backgroundColor=e.backgroundColor,this.overlayColor=e.overlayColor,this.compositeOperation=e.compositeOperation,this._image=null,this.imageX=e.imageX,this.imageY=e.imageY,this.acceptInputEvents=e.acceptInputEvents,this.captureInputEvents=e.captureInputEvents,this.cancelInputEvents=e.cancelInputEvents,this.paused=e.paused,this.tickSpeed=e.tickSpeed,this.buffer=e.buffer,this.bufferPadding=e.bufferPadding,this._buffer=null,this._bufferDirty=!0,this.debug=e.debug,this.children=[],this._removedChildren=[],this._tweenQueue=[],e.image&&(this.image=e.image),e.left!==undefined&&(this.left=e.left),e.top!==undefined&&(this.top=e.top),e.bottom!==undefined&&(this.bottom=e.bottom),e.right!==undefined&&(this.right=e.right),e.parent&&e.parent.addChild(this),this._inputStartID=null},dispose:function(){this._buffer=null,this.removeFromParent(),this.cancelTween(),this.removeListeners(),this.disposeChildren(),this._super()},disposeChildren:function(){var e=this.children;for(var t=0,n=e.length;t<n;++t)e[t].dispose()},set:function(e){for(var t in e)this[t]=e[t];return this},addChild:function(e){e.parent&&e.removeFromParent(),e.parent=this,this.children.push(e)},removeChild:function(e){e.parent==this&&this._removedChildren.indexOf(e)==-1&&(e.parent=null,this._removedChildren.push(e))},getChildByTag:function(e){for(var t=0,n=this.children.length;t<n;++t){var r=this.children[t];if(r.tag==e)return r}return null},removeChildren:function(){for(var e=0,t=this.children.length;e<t;++e){var n=this.children[e];n.removeFromParent()}},removeFromParent:function(){this.parent&&this.parent.removeChild(this),this.fire("removedFromParent",[this])},sortChildren:function(){this.children.sort(c)},show:function(){return this.visible=!0,this},hide:function(){return this.visible=!1,this},toggle:function(){return this.visible?this.hide():this.show()},shrinkwrap:function(e,t){e!==!1&&(this.width=0),t!==!1&&(this.height=0);var n=this.children;for(var r=0,i=n.length;r<i;++r){var s=n[r];e!==!1&&s.right>this.width&&(this.width=s.right),t!==!1&&s.bottom>this.height&&(this.height=s.bottom)}return this},redrawBuffer:function(){return this._bufferDirty=!0,this},createBoundTimer:function(e,t){var n=new s({interval:e,tickHost:this});return n.on("elapsed",this,t),n},react:function(e){if(!this.canReact)return;if(this.captureInputEvents){var t={x:e.point.x-this.left,y:e.point.y-this.top};for(var n=this.children.length-1;n>=0;--n){var r=this.children[n];if(r.canReact&&u.testPointInRect(t,r.bounds)){e.point.x=t.x,e.point.y=t.y,r.react(e);if(e.cancel===!0)return}}e.target||(e.target=this),e.point.x=t.x,e.point.y=t.y,this.fire(e.type,[e]),e.type==="inputStart"?this._inputStartID=e.id:e.type==="inputEnd"&&this._inputStartID===e.id&&(this.fire("inputPress",[e]),this._inputStartID=null)}this.cancelInputEvents&&(e.cancel=!0)},preTick:function(e){if(this.paused||!this.visible)return;var e=e*this.tickSpeed;this._cullChildren(),this._updateTween(e),this.tick&&this.tick(e),this.fire("tick",[e]);var t=this.children;for(var n=0,r=t.length;n<r;++n)t[n].preTick(e)},preRender:function(e){if(!this.visible||this.opacity<=0)return;var t=~~this.x,n=~~this.y,r=~~(this.pivotX*this.width),i=~~(this.pivotY*this.height),s=~~(this.anchorX*this.width),o=~~(this.anchorY*this.height);e.save();var u=this.compositeOpacity;u!==1&&(e.globalAlpha=u),this.compositeOperation&&(e.globalCompositeOperation=this.compositeOperation),e.translate(t-s+r,n-o+i),this.rotation!=0&&e.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&e.scale(this.scaleX,this.scaleY);if(this.flipX||this.flipY){var a=this.flipX?-1:1,f=this.flipY?-1:1;e.scale(a,f)}e.translate(-r,-i),this.clip&&(e.beginPath(),e.rect(0,0,this.width,this.height),e.clip(),e.closePath()),this.render&&this.width>0&&this.height>0&&(this.buffer?this._renderBuffer(e):this.render(e),this.debug&&this._renderDebug(e)),this.renderChildren(e),e.restore()},renderChildren:function(e){var t=this.children;for(var n=0,r=t.length;n<r;++n){var i=t[n];if(i.parent!==this)continue;i.preRender(e)}},render:function(e){var t=e;this.overlayColor&&(this._makeBuffer(),t=this._bufferContext),this._image&&this._image.ready?t.drawImage(this._image,this.imageX,this.imageY,this.width,this.height,0,0,this.width,this.height):this.backgroundColor&&(t.fillStyle=this.backgroundColor,t.fillRect(0,0,this.width,this.height)),this.overlayColor&&(t.globalCompositeOperation="source-atop",t.fillStyle=this.overlayColor,t.fillRect(0,0,this.width,this.height)),t!==e&&e.drawImage(this._bufferCanvas,0,0,this.width,this.height)},_makeBuffer:function(){if(this._bufferCanvas){this._bufferCanvas.width=this.width,this._bufferCanvas.height=this.height;return}this._bufferCanvas=o.createBuffer(this.width,this.height),this._bufferContext=this._bufferCanvas.getContext("2d")},align:function(e,t,n,r){if(!this.parent)return this;if(e){switch(e){case"left":this.left=0;break;case"right":this.right=this.parent.width;break;case"center":this.centerX=this.parent.width/2}this.left+=n||0}if(t){switch(t){case"top":this.top=0;break;case"bottom":this.bottom=this.parent.height;break;case"center":this.centerY=this.parent.height/2}this.top+=r||0}return this},centerOn:function(e,t,n){return e.centerX!==undefined?(this.centerX=e.centerX+(t||0),this.centerY=e.centerY+(n||0)):e.width!==undefined?(this.centerX=e.x+e.width/2+(t||0),this.centerY=e.y+e.height/2+(n||0)):(this.centerX=e.x+(t||0),this.centerY=e.y+(n||0)),this},tween:function(e,t,n,r){if(e!=null)for(var i in e){var s=e[i];typeof s!="object"&&(e[i]={from:null,to:s})}return this._tweenQueue.push({properties:e,duration:isNaN(t)?1e3:t,transition:n||a.linear,callback:r||null,elapsed:0}),this.visible||(logger.info(this.tag+": Auto-completing tween because this view is invisible"),this.completeTween()),this},delayTween:function(e,t){return this.tween(null,e,null,t)},cancelTween:function(e){return this._tweenQueue=[],e&&this.set(e),this},completeTween:function(e){var t=this._tweenQueue.length,n=this._tweenQueue.splice(0,t);for(var r=0;r<t;++r){var i=n[r];for(var s in i.properties)this[s]=i.properties[s].to;i.callback&&i.callback()}return e&&this.set(e),this},_updateTween:function(e){var t=this._tweenQueue,n=function(){var e=t.shift();e.callback&&e.callback()};while(e>0&&t.length>0){var r=t[0],i=r.duration-r.elapsed,s=Math.min(e,i);r.elapsed+=s,e-=s;if(r.properties===null){r.elapsed>=r.duration&&n();continue}if(r.elapsed>=r.duration||r.duration<=0){for(var o in r.properties)this[o]=r.properties[o].to;n()}else for(var o in r.properties){var u=r.properties[o];u.from==null&&(u.from=this[o]);var a=r.transition(r.elapsed,u.from,u.to-u.from,r.duration);this[o]=a}}},_cullChildren:function(){var e=this._removedChildren,t=e.length;if(t<1)return;var n=this.children;for(var r=0;r<t;++r){var i=e[r],s=n.indexOf(i);s!=-1?n.splice(s,1):logger.warn("Tried to remove non-child "+i.tag+" from "+this.tag)}e.splice(0,t)},_resizeBuffer:function(){var e=this._buffer,t=this.bufferPadding;e.width=this.width+t*2,e.height=this.height+t*2},_checkBuffer:function(){},_renderBuffer:function(e){var t=this._buffer,n=this.bufferPadding;this._bufferDirty||this._checkBuffer();if(this._bufferDirty){t||(t=this._buffer=f.create(1,1)),this._resizeBuffer();var r=t.getContext("2d");r.save(),r.translate(n,n),this.render(r),r.restore(),this._bufferDirty=!1}var i=this.width/2-t.width/2,s=this.height/2-t.height/2;e.drawImage(t,0,0,t.width,t.height,i,s,t.width,t.height)},_renderDebug:function(e){f.drawRect(e,0,0,this.width,this.height,"rgba(255, 0, 0, 0.15)","red",1)}});t.transitions=a;var h=t.prototype;Object.defineProperty(h,"left",{get:function(){return this.x-this.anchorX*this.width},set:function(e){this.x=e+this.anchorX*this.width}}),Object.defineProperty(h,"top",{get:function(){return this.y-this.anchorY*this.height},set:function(e){this.y=e+this.anchorY*this.height}}),Object.defineProperty(h,"right",{get:function(){return this.left+this.width},set:function(e){this.left=e-this.width}}),Object.defineProperty(h,"bottom",{get:function(){return this.top+this.height},set:function(e){this.top=e-this.height}}),Object.defineProperty(h,"centerX",{get:function(){return this.left+this.width/2},set:function(e){this.left=e-this.width/2}}),Object.defineProperty(h,"centerY",{get:function(){return this.top+this.height/2},set:function(e){this.top=e-this.height/2}}),Object.defineProperty(h,"bounds",{get:function(){return{x:this.left,y:this.top,width:this.width,height:this.height}}}),Object.defineProperty(h,"scale",{get:function(){return Math.max(this.scaleX,this.scaleY)},set:function(e){this.scaleX=e,this.scaleY=e}}),Object.defineProperty(h,"scaleWidth",{get:function(){return this.width*this.scaleX}}),Object.defineProperty(h,"scaleHeight",{get:function(){return this.height*this.scaleY}}),Object.defineProperty(h,"image",{set:function(e){this._image=i.get(e)}}),Object.defineProperty(h,"center",{get:function(){return{x:this.centerX,y:this.centerY}}}),Object.defineProperty(h,"compositeOpacity",{get:function(){var e=this.parent?this.parent.compositeOpacity:1;return this.opacity*e}}),Object.defineProperty(h,"canReact",{get:function(){return this.acceptInputEvents&&this.visible&&!this.paused}}),t.defaults={parent:null,x:0,y:0,z:1,pivotX:.5,pivotY:.5,anchorX:0,anchorY:0,acceptInputEvents:!1,captureInputEvents:!0,cancelInputEvents:!1,debug:!1,rotation:0,clip:!1,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,visible:!0,opacity:1,backgroundColor:null,overlayColor:null,compositeOperation:null,image:null,imageX:0,imageY:0,paused:!1,tickSpeed:1,buffer:!1,bufferPadding:10}}),n("djinn/TextView",["require","exports","module","./view/View","./utils/string"],function(e,t,n){var r=e("./view/View"),i=e("./utils/string"),t=n.exports=r.extend({init:function(e){e=merge(e,t.defaults),e.parent&&(!e.width||e.width<1)&&(e.width=e.parent.width);if(!e.height||e.height<1)e.height=e.fontSize;this._super(e),this._lineBuffer=null,this._rawText=null,this.color=e.color,this.fontSize=e.fontSize,this.fontFamily=e.fontFamily,this.shadowColor=e.shadowColor,this.shadowX=e.shadowX,this.shadowY=e.shadowY,this.strokeColor=e.strokeColor,this.strokeWidth=e.strokeWidth,this.textAlign=e.textAlign,this.verticalAlign=e.verticalAlign,this.wordWrap=e.wordWrap,this.autoSize=e.autoSize,this.text=e.text},render:function(e){this._super(e);if(this.text===undefined||this.text===null||this.text.length<1)return;this._lineBuffer==null&&this._bufferLines(this.text,e);var t=0,n=0;this.textAlign=="center"&&(t=this.width/2),this.textAlign=="right"&&(t=this.width),this.verticalAlign=="middle"&&(n=this.height/2),this._applyContextSettings(e);var r=e.measureText(this._rawText),i=~~r.width;this.autoSize&&i!==this.width&&(this.width=i,this.height=this.fontSize,this.fire("autoSize"));for(var s=0,o=this._lineBuffer.length;s<o;++s){var u=n+s*this.fontSize,a=this._lineBuffer[s];this.shadowColor&&(e.fillStyle=this.shadowColor,e.fillText(a,t+this.shadowX,u+this.shadowY)),this.strokeColor&&this.strokeWidth&&(e.lineWidth=this.strokeWidth,e.strokeStyle=this.strokeColor,e.strokeText(a,t,u)),e.fillStyle=this.color,e.fillText(a,t,u)}},_applyContextSettings:function(e){var t=i.sprintf("%spx %s",this.fontSize,this.fontFamily);e.font=t,e.textAlign=this.textAlign,e.textBaseline=this.verticalAlign,e.lineWidth=this.strokeWidth},_bufferLines:function(e,t){var e=String(e);this._lineBuffer=[];if(this.wordWrap){this._applyContextSettings(t);var n=e.split(" "),r=0;for(var i=0,s=n.length;i<s;++i){var o=this._lineBuffer[r]||"",u=o.length>0?o+" "+n[i]:n[i];o.length>0&&t.measureText(u).width>this.width?(++r,this._lineBuffer[r]=n[i]):this._lineBuffer[r]=u}}else this._lineBuffer.push(e)}});Object.defineProperty(t.prototype,"text",{get:function(){return this._rawText},set:function(e){this._lineBuffer=null,this._rawText=e===undefined?null:String(e)}}),t.defaults={color:"rgb(0, 0, 0)",fontFamily:"Arial",fontSize:20,shadowColor:null,shadowX:1,shadowY:1,strokeColor:null,strokeWidth:null,text:"",textAlign:"left",verticalAlign:"top",wordWrap:!0,autoSize:!1}}),n("djinn/ui/ProgressBar",["djinn/view/View"],function(e){return e.extend({init:function(e){var e=merge(e,{progress:0});this._super(e),this.progress=Number(e.progress)},render:function(e){this._super(e);var t=this.width*this.progress;e.fillStyle="rgb(100, 100, 100)",e.fillRect(0,0,t,this.height),e.lineWidth=2,e.strokeStyle="rgb(230, 230, 230)",e.strokeRect(0,0,this.width,this.height)}})}),n("djinn/utils/viewEffects",["djinn/math/core","djinn/utils/transitions"],function(e,t){return{alert:function(e,n,r){var n=n||{},i=e.z;e.completeTween({z:Infinity}).tween({scale:n.scale||1.5},(n.duration||500)/2,t.easeBoth,function(){n.midCallback&&n.midCallback()}).tween({scale:1},(n.duration||500)/2,t.easeBoth,function(){e.z=i,r&&r()})},burst:function(e,n,r){e.completeTween({opacity:0,scale:.5}),e.tween({opacity:1,rotation:Math.PI/2,scale:1.5},100,t.linear).tween({opacity:0},100,t.linear,function(){r&&r()})},buttonPress:function(e,n,r){e.completeTween().tween({y:e.y+e.height/10},50,t.linear).tween({y:e.y},50,t.linear,r)},fadeOut:function(e,n,r){var n=n||{};e.completeTween().tween({opacity:0},n.duration||500,t.linear,r)},fadeIn:function(e,n,r){var n=n||{};e.completeTween().tween({opacity:1},n.duration||500,t.linear,r)},fadeInAndOut:function(e,t,n){var t=t||{},r=(t.duration||1e3)/2;e.completeTween({opacity:0,visible:!0}),e.tween({opacity:t.opacity||1},r).tween({opacity:0},r,null,n)},popIn:function(n,r,i){var r=r||{},s=e.random(1,2)==1?2:-2,o=e.clamp(n.x+n.width*s,0,n.parent.width-n.width),u=n.y;n.completeTween({opacity:r.opacity||0,scale:r.scale||.5}),n.y+=n.height/2,n.tween({opacity:1,scale:1,x:o,y:u},200,t.linear).tween({scale:1.25},50,t.linear).tween({scale:1},50,t.linear,i)},popOut:function(e,n,r){e.completeTween({opacity:1}).tween({scale:.75},50,t.linear).tween({opacity:0,scale:2},250,t.linear,r)},shake:function(e,t,n){e.completeTween();var t=t||{},r=t.iterations||10,i=(t.duration||250)/r,s=t.violence||6,o=e.x,u=e.y;for(var a=0;a<r;++a)e.tween({x:e.x+s*(a%2?1:-1)},i);e.delayTween(0,function(){e.x=o,e.y=u,n&&n()})},squishyAppear:function(e,n,r){var n=n||{},i=n.duration||500,s=n.scale||1;e.completeTween({scaleX:2*s,scaleY:0}),e.tween({scaleX:.5*s,scaleY:2*s},i*.3,t.linear).tween({scaleX:s,scaleY:s},i*.7,t.elasticOut,function(){r&&r()})},squishyDisappear:function(e,n,r){var n=n||{},i=n.duration||500,s=n.scale||1;e.completeTween({scaleX:s,scaleY:s}),e.tween({scaleX:.5*s,scaleY:2*s},i*.3,t.linear).tween({scaleX:2*s,scaleY:0},i*.7,t.elasticOut,function(){r&&r()})},vibrate:function(t,n,r){t.completeTween();var n=n||{},i=n.iterations||10,s=(n.duration||250)/i,o=n.violence||6,u=t.x,a=t.y;for(var f=0;f<i;++f)t.tween({x:t.x+e.random(-o,o),y:t.y+e.random(-o,o)},s);t.delayTween(1,function(){t.x=u,t.y=a,r&&r()})}}}),n("djinn/helpers/LoadingScreen",["djinn/manifest","djinn/assets","djinn/view/View","djinn/TextView","djinn/ui/ProgressBar","djinn/utils/viewEffects","djinn/stage"],function(e,t,n,r,i,s,o){var u=merge(e.splash,{fadeDuration:1,displayDuration:0,backgroundColor:"rgb(0, 0, 0)",imageWidth:100,imageHeight:100});return n.extend({init:function(e){Object.defineProperty(this,"loadingProgress",{set:function(e){this._loadingBar.progress=e,this._loadingText.text="LOADING: "+~~(e*100)+"%"}});var e=merge({tag:"LoadingScreen",acceptInputEvents:!0,cancelInputEvents:!0,visible:!1,backgroundColor:u.backgroundColor,z:Infinity},e);this._super(e);if(u.images&&u.images.length>0){var s=u.images[o.sizeIndex];t.load(s.image),this._splashImage=(new n(merge({parent:this},s))).align("center","center")}var a=this.height*.05;this._loadingBar=(new i({parent:this,visible:!1,width:this.width*.8,height:a})).align("center","bottom",0,-a),this._loadingText=(new r({parent:this,visible:!1,text:"LOADING",textAlign:"center",verticalAlign:"middle",color:"rgb(255, 255, 255)",fontSize:~~(a*.75),height:a})).align("center","bottom",0,-a),this._uiDelayTimer=this.createBoundTimer(500,bind(this,"_onDelayElapsed")),this.on("inputStart",this,"_onInputStart")},show:function(e){this.set({opacity:0,visible:!0}),s.fadeIn(this,{duration:u.fadeDuration}),this.delayTween(u.displayDuration,function(){e&&e()}),this._uiDelayTimer.start()},hide:function(e){this.acceptInputEvents=!1,s.fadeOut(this,{duration:u.fadeDuration},bind(this,function(){this.visible=!1,e&&e()}))},_onDelayElapsed:function(){this._uiDelayTimer.stop(),this._loadingBar.progress<1&&(this._loadingText.visible=!0,this._loadingBar.visible=!0)},_onInputStart:function(e){this._onDelayElapsed(),this.completeTween()}})}),n("djinn/Collection",["djinn/utils/array","djinn/Emitter"],function(e,t){var n=t.extend({init:function(e){this._super(e),this.items=[],this._itemIDSeed=0,this._lookup={},this._length=0,this._indexPool=[]},add:function(e){typeof e.id=="undefined"&&(e.id=++this._itemIDSeed);if(this.has(e.id))return logger.warn("[Collection.add] Item ID conflict: "+e.id),null;if(this._indexPool.length>0){var t=this._indexPool.shift();this.items[t]=e}else{this._length=this.items.push(e);var t=this._length-1}return this._lookup[e.id]=t,this.fire("add",[e]),e.id},remove:function(e,t){var n=e.id||e,r=this._getIndex(n);if(!this._isValidIndex(r))return logger.warn("[Collection.remove] Tried to remove invalid item: "+n),null;var e=this.items[r];return this.items[r]=null,delete this._lookup[n],this._indexPool.push(r),t&&e.removeListeners&&e.removeListeners(),this.fire("remove",[e]),e},has:function(e){return this.get(e)!==null},get:function(e){var t=this._getIndex(e);if(isNaN(t)||t>=this._length)return null;var n=this.items[t]||null;return n},forEach:function(e,t){for(var n=0;n<this._length;++n){var r=this.items[n];if(r===null)continue;t?e.call(t,r,this):e(r,this)}},sort:function(){this.items.sort(function(e,t){return e?t?t.id-e.id:-1:1}),this._rebuild()},pickRandom:function(){return e.pickRandom(this.items)},removeAll:function(e){this.forEach(function(t,n){if(!t)return;this.remove(t.id,e)},this),this.items=[],this._lookup={},this._indexPool=[],this._length=0},_getIndex:function(e){return this._lookup[e]},_isValidIndex:function(e){return e>=0&&e<this._length},_rebuild:function(){this._lookup={},this._indexPool=[];for(var e=0,t=this.items.length;e<t;++e){var n=this.items[e];n?this._lookup[n.id]=e:this._indexPool.push(e)}}});return Object.defineProperty(n.prototype,"length",{get:function(){return this._length}}),n}),n("djinn/utils/log",["require","exports","module","./string"],function(e,t,n){var r=e("./string"),i=function(e){return e.length>1?r.sprintf.apply(null,e):e[0]};t.info=function(){console.info(i(arguments))},t.warn=function(){console.warn(i(arguments))},t.error=function(){console.error(i(arguments))}}),n("djinn/audio/jukebox",["require","exports","module","../Emitter","../client","../math/core","../utils/array","../utils/log"],function(e,t,n){var r=e("../Emitter"),i=e("../client"),s=e("../math/core"),o=e("../utils/array"),u=e("../utils/log"),a=r.extend({init:function(e){this._super(e),this.audioData=null,this.multishotThreshold=100,this.sounds={},this._unmuteOnShow=!1,this._playTimes={},i.on("visibilityChange",this,"_onClientVisibilityChange")},configure:function(e){this.audioData=e},mute:function(){Howler.mute(),this.fire("mute")},unmute:function(){Howler.unmute(),this.fire("unmute")},toggleMute:function(){this.muted=!this.muted},preloadByType:function(e){var e=o.force(e),t=this.sounds;for(var n in t){var r=this._getAudioData(n),i=r.type||"sound";if(!o.contains(e,i))continue;this.load(n)}},load:function(e,t){var n=this.sounds;if(n[e])return n[e];var r=this._getAudioData(e);if(!r)return;var i=[r.path+".ogg",r.path+".mp3"],s=this._getVolume(e),o=n[e]=new Howl({urls:i,loop:r.loop,buffer:r.type==="music",onload:function(){this.volume(s),t&&t()},onloaderror:function(){u.warn("[jukebox.load] Failed to load: "+e)}});return o},play:function(e,t){var n=this._getSound(e,!0);if(!n)return;var r=this._playTimes,i=r[e],s=Date.now();if(i&&s-i<this.multishotThreshold)return;r[e]=s,t!==undefined&&n.pos(t),n.play(),n.volume(this._getVolume(e))},pause:function(e){var t=this._getSound(e);if(!t)return;t.pause()},stop:function(e){var t=this._getSound(e);if(!t)return;t.stop()},fadeIn:function(e,t){var n=this._getSound(e,!0);if(!n)return;var r=this._getVolume(e);n.play().fade(0,r,t)},fadeOut:function(e,t){var n=this._getSound(e);if(!n)return;n.fade(n.volume(),0,t,function(){n.stop()})},_getAudioData:function(e){var t=this.audioData;return t&&t.sounds&&t.sounds[e]?t.sounds[e]:(u.warn("[jukebox._getAudioData] No audio data: "+e),null)},_getSound:function(e,t){var n=this.sounds;if(n&&n[e])return n[e];if(t){var r=this.load(e);return r?r:(u.warn("[jukebox._getSound] Unable to load sound: "+e),null)}return null},_getVolume:function(e){var t=this._getAudioData(e);if(!t)return 1;switch(t.type){case"music":var n=this.musicVolume;break;default:var n=this.soundVolume}return t.volume!==undefined&&(n*=t.volume),n},_updateVolume:function(){var e=this.sounds;for(var t in e){var n=e[t],r=this._getVolume(t);n.volume()!==r&&n.volume(r)}},_onClientVisibilityChange:function(e){e?this.muted||(this.mute(),this._unmuteOnShow=!0):this._unmuteOnShow&&(this.unmute(),this._unmuteOnShow=!1)}}),f=a.prototype;Object.defineProperty(f,"muted",{get:function(){return Howler._muted},set:function(e){e?this.mute():this.unmute()}}),Object.defineProperty(f,"musicVolume",{get:function(){return this._musicVolume},set:function(e){this._musicVolume=s.clamp(e,0,1),this._updateVolume()}}),Object.defineProperty(f,"soundVolume",{get:function(){return this._soundVolume},set:function(e){this._soundVolume=s.clamp(e,0,1),this._updateVolume()}}),n.exports=new a}),n("djinn/Scene",["require","exports","module","./view/View","./audio/jukebox"],function(e,t,n){var r=e("./view/View"),i=e("./audio/jukebox"),t=n.exports=r.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.musicKey=e.musicKey,this._isSetup=!1},setup:function(){this.musicKey&&i.load(this.musicKey)},reset:function(){},activate:function(e){this.musicKey&&i.fadeIn(this.musicKey,500),this.captureInputEvents=!0},deactivate:function(e){this.musicKey&&i.fadeOut(this.musicKey,500),this.captureInputEvents=!1},cleanup:function(){this.musicKey&&i.stop(this.musicKey)},fireSceneEvent:function(e){var t={id:this.id,eventName:e};this.fire(e,[t])}});t.defaults={acceptInputEvents:!0,cancelInputEvents:!0,clip:!0,musicKey:null,opacity:0,visible:!1}}),n("djinn/view/effects/Spotlight",["djinn/view/View","djinn/stage"],function(e,t){var n=["width","height","spotlightX","spotlightY","spotlightRadius"];return e.extend({init:function(e){var e=merge(e,{backgroundColor:"rgb(0, 0, 0)",spotlightX:0,spotlightY:0,spotlightRadius:100});this._super(e),this._buffer=t.createBuffer(this.width,this.height),this._bufferDirty=!0,this.spotlightX=Number(e.spotlightX),this.spotlightY=Number(e.spotlightY),this.spotlightRadius=Number(e.spotlightRadius),this._cachedProps={},t.on("resize",this,function(){this._bufferDirty=!0})},render:function(e){var t=this._buffer;if(t.width!==this.width||t.height!==this.height)t.width=this.width,t.height=this.height,this._bufferDirty=!0;if(!this._bufferDirty)for(var r=0,i=n.length;r<i;++r){var s=n[r];if(this._cachedProps[s]!=this[s]){this._bufferDirty=!0;break}}if(this._bufferDirty){var o=t.getContext("2d");o.save(),o.clearRect(0,0,this.width,this.height),o.fillStyle=this.backgroundColor,o.fillRect(0,0,this.width,this.height),o.globalCompositeOperation="destination-out",o.beginPath(),o.arc(this.spotlightX,this.spotlightY,this.spotlightRadius,0,Math.PI*2,!0),o.fill(),o.closePath(),o.restore();for(var r=0,i=n.length;r<i;++r){var s=n[r];this._cachedProps[s]=this[s]}this._bufferDirty=!1}e.drawImage(this._buffer,0,0,this.width,this.height)}})}),n("djinn/utils/sceneTransitions",["require","exports","module","djinn/utils/transitions","djinn/view/effects/Spotlight"],function(e,t,n){var r=e("djinn/utils/transitions"),i=e("djinn/view/effects/Spotlight"),s=function(e,t){e.completeTween(merge(t,{visible:!0,opacity:1,scale:1,rotation:0,x:0,y:0}))};t.none=function(e,t,n,r){s(t,{visible:!0}),e.visible=!1,r&&r()},t.crossFade=function(e,t,n,r){var n=merge(n,{duration:500});s(e),s(t,{opacity:0}),e.tween({opacity:0},n.duration,null,function(){e.visible=!1,r&&r()}),t.tween({opacity:1},n.duration)},t.fade=function(e,t,n,r){var n=merge(n,{duration:500});s(e),s(t,{opacity:0}),e.tween({opacity:0},n.duration,null,function(){e.visible=!1,t.tween({opacity:1},n.duration,null,r)})},t.rotateIn=function(e,t,n,r){var n=merge(n,{duration:1e3});s(t,{scale:0,rotation:Math.PI}),t.tween({scale:1,rotation:0},n.duration,null,function(){e.visible=!1,r&&r()})},t.slideUp=function(e,t,n,i){var n=merge(n,{duration:500});s(e),s(t,{y:t.parent.height}),e.tween({y:-e.height},n.duration,r.easeIn,function(){e.visible=!1,i&&i()}),t.tween({y:0},n.duration,r.easeIn)},t.slideDown=function(e,t,n,i){var n=merge(n,{duration:500});s(e),s(t,{bottom:0}),e.tween({y:e.height},n.duration,r.easeIn,function(){e.visible=!1,i&&i()}),t.tween({y:0},n.duration,r.easeIn)},t.slideLeft=function(e,t,n,i){var n=merge(n,{duration:500});s(e),s(t,{x:t.width}),e.tween({right:0},n.duration,r.easeIn,function(){e.visible=!1,i&&i()}),t.tween({x:0},n.duration,r.easeIn)},t.slideRight=function(e,t,n,i){var n=merge(n,{duration:500});s(e),s(t,{right:0}),e.tween({x:e.width},n.duration,r.easeIn,function(){e.visible=!1,i&&i()}),t.tween({x:0},n.duration,r.easeIn)};var o=new i({backgroundColor:"black",visible:!1});t.spotlight=function(e,t,n,i){var n=merge(n,{duration:2e3,delay:500});s(e),o.completeTween({width:e.width,height:e.height,visible:!0,spotlightX:e.width/2,spotlightY:e.height/2,spotlightRadius:e.width}),o.removeFromParent(),e.parent.addChild(o),o.tween({spotlightRadius:0},n.duration,r.easeIn,function(){e.visible=!1,s(t),o.delayTween(n.delay).tween({spotlightRadius:e.width},n.duration,r.easeIn,function(){o.visible=!1,o.removeFromParent(),i&&i()})})},t.zoomSpotlight=function(e,t,n,i){var n=merge(n,{duration:2e3,delay:500,scale:2});s(e),o.completeTween({width:e.width,height:e.height,visible:!0,z:Math.max(e.z,t.z)+1,opacity:0,spotlightX:e.width/2,spotlightY:e.height/2,spotlightRadius:0}),o.removeFromParent(),e.parent.addChild(o),e.tween({scale:n.scale},n.duration),o.tween({opacity:1},n.duration,r.easeIn,function(){e.visible=!1,s(t),o.delayTween(n.delay).tween({spotlightRadius:e.width},n.duration,r.easeIn,function(){o.visible=!1,o.removeFromParent(),i&&i()})})}}),n("djinn/SceneDirector",["require","exports","module","djinn/Emitter","djinn/Collection","djinn/Scene","djinn/utils/sceneTransitions"],function(e,t,n){var r=e("djinn/Emitter"),i=e("djinn/Collection"),s=e("djinn/Scene"),o=e("djinn/utils/sceneTransitions"),t=n.exports=r.extend({init:function(e){this._super(e),this.backgroundColor=e.backgroundColor||"black",this.view=e.view},setup:function(e){this._data=e},load:function(){this._activeSceneId=null,this.scenes=new i,this._defaultScene=new s({parent:this.view,backgroundColor:this.backgroundColor,visible:!1});var e=this._data;for(var t in e){var n=e[t],r=new n.ctor({parent:this.view,id:t});for(var o in n.events)r.on(o,this,"_onSceneEvent");this.scenes.add(r)}},ready:function(){},activateScene:function(e,t,n){var r=this._activeSceneId,i=this.scenes.get(this._activeSceneId)||this._defaultScene,s=this.scenes.get(e);this._activeSceneId=e,s.isSetup||(s.setup(),s.isSetup=!0),s.reset(r);var t=o[t||"fade"];this.view.backgroundColor=this.backgroundColor,i&&(i.captureInputEvents=!1,i.deactivate(this._activeSceneId)),s.captureInputEvents=!1,t(i,s,n,bind(this,function(){this.view.backgroundColor=null,i.cleanup(e),s.activate(r)}))},_onSceneEvent:function(e){var t=this._data[e.id].events[e.eventName];this.activateScene(t.id,t.transition,t.conf)}});Object.defineProperty(t.prototype,"activeSceneId",{get:function(){return this._activeSceneId}}),Object.defineProperty(t.prototype,"activeScene",{get:function(){return this.scenes.get(this._activeSceneId)}})}),n("djinn/platforms/steam",["require","exports","module","../utils/log"],function(e,t,n){var r=e("../utils/log");t.init=function(){greenworks.initAPI()},t.getCloudQuota=function(e){greenworks.getCloudQuota(function(t,n){e&&e(t,n)},function(){r.warn("[steam.getCloudData] Failed to get cloud quota")})},t.writeCloudFile=function(e,t,n){greenworks.saveTextToFile(e,t,function(){n&&n()},function(){r.warn("[steam.writeCloudFile] Failed to write cloud file: "+e)})},t.readCloudFile=function(e,t){greenworks.readTextFromFile(e,function(e){t&&t(e)},function(){r.warn("[steam.readCloudFile] Failed to read cloud file: "+e)})},t.activateAchievement=function(e,t){greenworks.activateAchievement(e,function(){t&&t()},function(){r.warn("[steam.activateAchievement] Failed to activate: "+e)})}}),n("djinn/Game",["require","exports","module","djinn/input/keyboard","djinn/input/gamepad","djinn/Emitter","djinn/globalTimer","djinn/client","djinn/stage","djinn/view/View","djinn/helpers/LoadingScreen","djinn/manifest","djinn/assets","djinn/SceneDirector","./platforms/steam"],function(e,t,n){var r=e("djinn/input/keyboard"),i=e("djinn/input/gamepad"),s=e("djinn/Emitter"),o=e("djinn/globalTimer"),u=e("djinn/client"),a=e("djinn/stage"),f=e("djinn/view/View"),l=e("djinn/helpers/LoadingScreen"),c=e("djinn/manifest"),h=e("djinn/assets"),p=e("djinn/SceneDirector"),d=e("./platforms/steam"),t=n.exports=s.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),u.isSteam&&d.init(),this.showLoadingScreen=e.showLoadingScreen,this._splashFinished=!1,this._loadingProgress=0,this.view=new f({tag:"GameRootView",acceptInputEvents:!0,width:a.width,height:a.height}),a.on("resize",this,"_onStageResize"),this._loadingScreen=new l({parent:this.view,visible:!1}),this._sceneDirector=new p({view:this.view})},run:function(){o.on("tick",this,"_update"),o.start(),this.showLoadingScreen&&(a.eraseBeforeRender=!0,this._loadingScreen.show(bind(this,"_onSplashFinish")))},stop:function(){o.stop(),o.off("tick",this)},setupScenes:function(e){this._sceneDirector.setup(e)},getSceneById:function(e){return this._sceneDirector.scenes.get(e)},getActiveSceneId:function(){return this._sceneDirector.activeSceneId},getActiveScene:function(){return this._sceneDirector.activeScene},activateScene:function(e,t,n){this._sceneDirector.activateScene(e,t,n)},preloadAssets:function(e){h.load(e,bind(this,"_onLoadComplete"),bind(this,"_onLoadProgress"))},_onLoadProgress:function(e,t,n,r,i){this._loadingProgress=i,this._loadingScreen.loadingProgress=this._loadingProgress,this._checkGameReady()},_onLoadComplete:function(){a.acceptInput=!0,this._sceneDirector.load(),this.fire("load")},_update:function(e){this._react(),this.update&&this.update(e),this.view.preTick(e),this._render(),r.endFrame(),i.endFrame()},_react:function(){var e=a.getInputEvents(),t=e.length;for(var n=0;n<t;++n)this.view.react(e[n])},_render:function(){a.renderView(this.view)},_onStageResize:function(){this.view.width=a.width,this.view.height=a.height},_onSplashFinish:function(){this._splashFinished=!0,this._checkGameReady()},_checkGameReady:function(){this._splashFinished&&this._loadingProgress===1&&this._loadingScreen.hide(bind(this,function(){a.eraseBeforeRender=!1,this._sceneDirector.ready(),this.fire("ready")}))}});t.defaults={showLoadingScreen:!1}}),n("djinn/view/Text",["require","exports","module","./View","./utils/canvas","../utils/string"],function(e,t,n){var r=e("./View"),i=e("./utils/canvas"),s=e("../utils/string"),o=i.create(1,1),u=o.getContext("2d"),t=n.exports=r.extend({init:function(e){var e=merge(e,t.defaults);this.format=e.format||this.format,this.text=e.text,this.fontFamily=e.fontFamily,this.fontSize=e.fontSize,this.lineHeight=e.lineHeight,this.textAlign=e.textAlign,this.fillColor=e.fillColor,this.strokeColor=e.strokeColor,this.strokeWidth=e.strokeWidth,this.shadowColor=e.shadowColor,this.shadowOffsetX=e.shadowOffsetX,this.shadowOffsetY=e.shadowOffsetY,this.wordWrapWidth=e.wordWrapWidth,this._textWidth=0,this._maxLineWidth=0,this._autoSize(),e.width=this.width,e.height=this.height,this._super(e)},render:function(e){if(this._text===null)return;var t=this._getFont(),n=this._lines,r=this._getLineHeight(),s=0;switch(this.textAlign){case"center":s=this.width/2;break;case"right":s=this.width}for(var o=0,u=n.length;o<u;++o)i.drawText(e,n[o],s,o*r+r/2,t,this.fillColor,this.strokeColor,this.strokeWidth,this.textAlign,"middle",this.shadowColor,this.shadowOffsetX,this.shadowOffsetY)},_getFont:function(){return s.sprintf("%spx %s",this.fontSize,this.fontFamily)},_getLineHeight:function(){return isNaN(this.lineHeight)?this.fontSize:this.lineHeight},_autoSize:function(){this._textWidth=i.getTextWidth(u,this._text,this._getFont()),this._parseLines();var e=this._maxLineWidth,t=this._lines.length*this._getLineHeight();if(this.width!==e||this.height!==t)this.width=e,this.height=t,this.fire("autoSize")},_parseLines:function(){var e=this._lines=[];this._maxLineWidth=0;var t=this._getFont();if(this.wordWrapWidth>0){var n=this._text.split(/\s/),r=0;for(var s=0,o=n.length;s<o;++s){var a=e[r]||"",f=a.length>0?a+" "+n[s]:n[s],l=i.getTextWidth(u,f,t);a.length>0&&l>this.wordWrapWidth?(++r,e[r]=n[s],l=i.getTextWidth(u,n[s],t)):e[r]=f,this._maxLineWidth=Math.max(l,this._maxLineWidth)}}else e.push(this._text),this._maxLineWidth=this._textWidth},_resizeBuffer:function(){this._autoSize(),this._super()},_checkBuffer:function(){var e=i.getTextWidth(u,this._text,this._getFont());e!==this._textWidth&&this.redrawBuffer()}}),a=t.prototype;Object.defineProperty(a,"text",{get:function(){return this._text},set:function(e){this.format&&(e=this.format(e));if(this._text==e)return;this._text=e===undefined?null:String(e),this._autoSize(),this.redrawBuffer()}}),t.defaults={buffer:!0,format:null,fontFamily:"Arial",fontSize:20,textAlign:"left",fillColor:"white",strokeColor:null,strokeWidth:1,shadowColor:null,shadowOffsetX:5,shadowOffsetY:5,wordWrapWidth:0}}),n("djinn/math/PRNG",["require","exports","module","../utils/string","../utils/array"],function(e,t,n){var r=e("../utils/string"),i=e("../utils/array"),s=2147483648,o=1103515245,u=12345;n.exports=function(e){this.state=null,e&&this.seed(e)};var a=n.exports.prototype;a.seed=function(e){e?isNaN(e)&&(e=r.hashCharCode(String(e))):e=Math.floor(Math.random()*(s-1)),this.seedValue=e,this.state=e},a.normal=function(){return this.state===null?Math.random():(this.state=(o*this.state+u)%s,this.state/s)},a.integer=function(e){return Math.round(this.normal()*e)},a.range=function(e,t){return this.integer(t-e)+e},a.radians=function(e,t){var e=e||0,t=t||Math.PI*2,n=t-e;return e+n*this.normal()},a.chance=function(e){return this.normal()<=e},a.choice=function(e,t){if(e.length===0)return null;var n=this.integer(e.length-1),r=e[n];return t&&e.splice(n,1),r},a.weightedChoice=function(e){var t=arguments.length>1;if(t||i.isArray(e))e=this.autoWeight(t?arguments:e);var n=0,r={};for(var s in e){var o=~~(n*1e3);n+=e[s],r[s]={min:o,max:~~(n*1e3)}}var u=this.integer(~~(n*1e3)-1);for(var s in r){var a=r[s];if(u>=a.min&&u<a.max)return s}return logger.warn("[PRNG.weightedChoice] No matching option found!",u,r),null},a.weightedIndex=function(e,t){var n=[];for(var r=0;r<e;++r)n.push(r);var i=this.autoWeight(n,t);return+this.weightedChoice(i)},a.autoWeight=function(e,t){var t=t||2,n={},r=0;for(var i=0,s=e.length;i<s;++i){var o=Math.pow(s-i,t);n[e[i]]=o,r+=o}var u=1/r;for(var a in n)n[a]*=u;return n}}),n("djinn/math/random",["require","exports","module","./PRNG"],function(e,t,n){var r=e("./PRNG");return new r}),n("djinn/sim/shared/position",["require","exports","module","djinn/math/Vector2"],function(e,t,n){var r=e("djinn/math/Vector2");t.getBounds=function(e){var t=e.position,n=e.size;return!t||!n?null:{x:t.x,y:t.y,width:n.width,height:n.height}},t.getCenter=function(e){var t=e.position,n=e.size;return!t||!n?null:{x:t.x+n.width/2,y:t.y+n.height/2}},t.centerOnPoint=function(e,t,n){var r=e.position,i=e.size;r.x=t-i.width/2,r.y=n-i.height/2},t.centerOnEntity=function(e,n){var r=t.getCenter(n);t.centerOnPoint(e,r.x,r.y)},t.centerOnTile=function(e,n,r,i){t.centerOnPoint(e,r*n.tileWidth+n.tileWidth/2,i*n.tileHeight+n.tileHeight/2)},t.getAimVector=function(e,n){var i=t.getCenter(e),s=t.getCenter(n);return(new r(s)).subtract(i).normalize()}}),n("djinn/core/Collection",["require","exports","module","../Class"],function(e,t,n){var r=e("../Class"),t=n.exports=r.extend({init:function(){this.items=[],this._indexPool=[]},dispose:function(){this.disposeItems(),this._super()},disposeItems:function(){this.forEach(function(e){this.remove(e),e&&e.dispose&&e.dispose()},this)},add:function(e){var t=this._indexPool;if(t.length>0){var n=t.shift();this.items[n]=e}else this.items.push(e)},remove:function(e){var t=this.items.indexOf(e);if(t===-1)return;delete this.items[t],this._indexPool.push(t)},removeAll:function(){this.forEach(function(e){this.remove(e)},this)},get:function(e,t,n){var r=[],i=this.items;for(var s=0,o=i.length;s<o;++s){var u=i[s];if(u===undefined)continue;if(t)var a=e.call(t,u,s);else var a=e(u,s);a&&r.push(u)}return n?r.length>0?r[0]:null:r},forEach:function(e,t){var n=this.items;for(var r=0,i=n.length;r<i;++r){var s=n[r];if(s===undefined)continue;t?e.call(t,s,r):e(s,r)}}}),i=t.prototype;Object.defineProperty(i,"length",{get:function(){return this.items.length}})}),n("djinn/sim/TileMap",["require","exports","module","../Class"],function(e,t,n){var r=e("../Class"),t=n.exports=r.extend({init:function(e){var e=merge(e,t.defaults);this.width=e.width,this.height=e.height,this.tileWidth=e.tileWidth,this.tileHeight=e.tileHeight,this.values=[]},resize:function(e,t){this.width=e,this.height=t},get:function(e,t){return this.getByIndex(this.xyToIndex(e,t))},getByIndex:function(e){return this.values[e]},getSegmentsByRect:function(e,t,n,r){var i=[],s=this.getTilesByRect(e,t,n,r),o=this.tileWidth,u=this.tileHeight;for(var a=0,f=s.length;a<f;++a){var l=s[a],c=l.x*o,h=c+o,p=l.y*u,d=p+u;this.get(l.x,l.y-1)===0&&i.push([c,p,h,p]),this.get(l.x+1,l.y)===0&&i.push([h,p,h,d]),this.get(l.x,l.y+1)===0&&i.push([c,d,h,d]),this.get(l.x-1,l.y)===0&&i.push([c,p,c,d])}return i},getTilesByRect:function(e,t,n,r){var i=~~(e/this.tileWidth),s=~~(t/this.tileHeight),o=Math.ceil((e+n)/this.tileWidth),u=Math.ceil((t+r)/this.tileHeight),a=[];for(var t=s;t<=u;++t)for(var e=i;e<=o;++e){var f=this.get(e,t);if(f===0)continue;a.push({x:e,y:t})}return a},set:function(e,t,n){this.setByIndex(this.xyToIndex(e,t),n)},setByIndex:function(e,t){this.values[e]=t},setRect:function(e,t,n,r,i){for(var s=t;s<t+r;++s)for(var o=e;o<e+n;++o)this.set(o,s,i)},fill:function(e){var t=this.values;for(var n=0,r=this.size;n<r;++n)t[n]=e},forEach:function(e,t){var n=this.values;for(var r=0,i=n.length;r<i;++r){var s=this.indexToX(r),o=this.indexToY(r);t?e.call(t,n[r],s,o,this):e(n[r],s,o,this)}},indexToX:function(e){return e%this.width},indexToY:function(e){return Math.floor(e/this.width)},xyToIndex:function(e,t){return t*this.width+e},unitToTile:function(e,t){return{x:~~(e/this.tileWidth),y:~~(t/this.tileHeight)}},tileToUnit:function(e,t){return{x:e*this.tileWidth,y:t*this.tileHeight}}}),i=t.prototype;Object.defineProperty(i,"size",{get:function(){return this.width*this.height}}),Object.defineProperty(i,"unitWidth",{get:function(){return this.width*this.tileWidth}}),Object.defineProperty(i,"unitHeight",{get:function(){return this.height*this.tileHeight}}),t.defaults={width:0,height:0,tileWidth:100,tileHeight:100}}),n("djinn/sim/World",["require","exports","module","../math/core","../Emitter","../core/Collection","../utils/log","./TileMap","./shared/position"],function(e,t,n){var r=e("../math/core"),i=e("../Emitter"),s=e("../core/Collection"),o=e("../utils/log"),u=e("./TileMap"),a=e("./shared/position"),t=n.exports=i.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.running=!1,this.elapsed=0,this.deltaPool=0,this.deltaStep=e.deltaStep,this.width=e.width,this.height=e.height,this.systems=[],this.entities=s.create(),this._entityIdSeed=0,this._prefabs={},this.camera={x:0,y:0},this._cameraTarget=null,this.map=new u},resizeToMap:function(){this.width=this.map.unitWidth,this.height=this.map.unitHeight},reset:function(){this.stop(),this.elapsed=0,this.deltaPool=0,this._entityIdSeed=0,this.triggerSystems("reset")},start:function(){this.running=!0,this.triggerSystems("start")},stop:function(){this.running=!1,this.triggerSystems("stop")},addSystem:function(e){this.systems.push(e)},triggerSystems:function(e,t){var n=this.systems;for(var r=0,i=n.length;r<i;++r)this._triggerSystem(n[r],e,t)},definePrefabs:function(e){for(var t in e)this._prefabs[t]=e[t]},createEntity:function(e,t){if(!this._prefabs[e])return o.warn("[World.createEntity] Invalid prefab type: %s",e),null;var n=merge(t,this._prefabs[e]);return n.type=e,n},clean:function(){var e=this.entities.items;for(var t=0,n=e.length;t<n;++t){var r=e[t];r&&this.despawnEntity(r)}},spawnEntity:function(e){e.id=++this._entityIdSeed,this.entities.add(e),this.triggerSystems("entitySpawn",[e]),this.fire("entitySpawn",[e])},despawnEntity:function(e){this.triggerSystems("entityDespawn",[e]),this.fire("entityDespawn",[e]),this.entities.remove(e)},getEntityById:function(e){var t=this.entities.items;for(var n=0,r=t.length;n<r;++n){var i=t[n];if(i&&i.id===e)return i}return null},getEntityByType:function(e){var t=this.entities.items;for(var n=0,r=t.length;n<r;++n){var i=t[n];if(i&&i.type===e)return i}return null},getEntitiesByType:function(e){var t=[],n=this.entities.items;for(var r=0,i=n.length;r<i;++r){var s=n[r];s&&s.type===e&&t.push(s)}return t},getEntitiesByRect:function(e){var t=[],n=this.entities.items;for(var i=0,s=n.length;i<s;++i){var o=n[i];o&&r.intersects(e,a.getBounds(o))&&t.push(o)}return t},update:function(e){if(!this.running)return;this.deltaPool+=e;var t=this.deltaStep;while(this.deltaPool>=t)this.deltaPool-=t,this._update(t),this.elapsed+=t},setCameraTarget:function(e){this._cameraTarget=e,this._updateCamera()},_triggerSystem:function(e,t,n){if(!e[t])return;return e[t].apply(this,n)},_update:function(e){this.triggerSystems("update",[e]);var t=this.entities.items;for(var n=0,r=t.length;n<r;++n){var i=t[n];if(i===undefined)continue;this.triggerSystems("entityUpdate",[t[n],e])}this.triggerSystems("postUpdate"),this._updateCamera()},_updateCamera:function(){var e=this._cameraTarget;if(!e)return;var t=a.getCenter(e);this.camera.x=t.x,this.camera.y=t.y}});t.defaults={deltaStep:16,width:1e3,height:1e3}}),n("djinn/sim/systems/physics",["require","exports","module","../../math/core"],function(e,t,n){var r=e("../../math/core"),i=function(e,t){var n=e.position,i=e.velocity,s=e.bounce,o=t.normal;o.x!==0?(n.x+=o.x*t.penetration,o.x===-r.sign(i.x)&&(i.x=s?-i.x*s.x:0)):(n.y+=o.y*t.penetration,o.y===-r.sign(i.y)&&(i.y=s?-i.y*s.y:0))};t.entityUpdate=function(e,t){var n=e.position,r=e.velocity,i=e.gravity,s=e.acceleration,o=e.drag;if(!n||!r)return;if(n.immovable)return;i&&(r.y+=i.value*t/2),o&&(r.x-=o.x*r.x,r.y-=o.y*r.y),s&&(r.x+=s.x,r.y+=s.y),n.x+=r.x*t,n.y+=r.y*t,i&&(r.y+=i.value*t/2)},t.entityCollide=function(e,t,n){if(e.position.immovable||!t.collision.solid)return;i(e,n)},t.entityMapCollide=function(e,t,n,r){i(e,r)},t.entityWorldCollide=function(e,t,n){var i=e.velocity,s=e.bounce;r.sign(i.x)===t&&(i.x=s?-i.x*s.x:0),r.sign(i.y)===n&&(i.y=s?-i.y*s.y:0)}}),n("djinn/math/QuadTree",["djinn/Class","djinn/math/core","djinn/utils/array"],function(e,t,n){var r=[],i={parent:-1,topLeft:0,topRight:1,bottomLeft:2,bottomRight:3},s=function(e){if(r.length>0){var t=r.pop();return t.set(e),t}return new o(e)},o=e.extend({init:function(e){var e=merge(e,{x:0,y:0,width:0,height:0,depth:0,maxChildren:2,maxDepth:4});this._nodes=[],this._children=[],this.set(e)},set:function(e){for(var t in e)this[t]=e[t]},insert:function(e){var t=this._nodes,n=this._children;if(t.length>0){var r=this._findInsertNode(e);r===i.parent?n.push(e):t[r].insert(e)}else n.push(e),n.length>this.maxChildren&&this.depth<this.maxDepth&&this.divide()},retrieve:function(e){var t=[],n=this._children;for(var r=0,i=n.length;r<i;++r)t.push(n[r]);if(this._nodes.length>0){var s=this._findIntersectNodes(e);for(var r=0,i=s.length;r<i;++r)t=t.concat(s[r].retrieve(e))}return t},divide:function(){var e=~~(this.width/2),t=~~(this.height/2),n=this._children;this._addNode(this.x,this.y,e,t),this._addNode(this.x+e,this.y,e,t),this._addNode(this.x,this.y+t,e,t),this._addNode(this.x+e,this.y+t,e,t),this._children=[];for(var r=0,i=n.length;r<i;++r)this.insert(n[r])},clear:function(){var e=this._nodes;while(e.length>0){var t=e.pop();t.clear(),r.push(t)}this._children=[],this._nodes=[]},_addNode:function(e,t,n,r){this._nodes.push(s({x:e,y:t,width:n,height:r,depth:this.depth+1,maxChildren:this.maxChildren,maxDepth:this.maxDepth}))},_findInsertNode:function(e){var t=this.x+this.width/2,n=this.y+this.height/2;return e.x+e.width<t?e.y+e.height<n?i.topLeft:e.y>=n?i.bottomLeft:i.parent:e.x>=t?e.y+e.height<n?i.topRight:e.y>=n?i.bottomRight:i.parent:i.parent},_findIntersectNodes:function(e){var t=[],n=this._nodes,r=this.x+this.width/2,s=this.y+this.height/2;return e.x<r&&(e.y<s&&t.push(n[i.topLeft]),e.y+e.height>=s&&t.push(n[i.bottomLeft])),e.x+e.width>=r&&(e.y<s&&t.push(n[i.topRight]),e.y+e.height>=s&&t.push(n[i.bottomRight])),t}}),u=e.extend({init:function(e){this.rootNode=s(e)},insert:function(e){var t=this.rootNode;if(n.isArray(e))for(var r=0,i=e.length;r<i;++r)t.insert(e[r]);else t.insert(e)},retrieve:function(e){return this.rootNode.retrieve(e)},clear:function(){this.rootNode.clear()},resize:function(e,t){this.width=e,this.height=t}});return Object.defineProperty(u.prototype,"width",{get:function(){return this.rootNode.width},set:function(e){this.clear(),this.rootNode.width=e}}),Object.defineProperty(u.prototype,"height",{get:function(){return this.rootNode.height},set:function(e){this.clear(),this.rootNode.height=e}}),u}),n("djinn/sim/systems/collision",["require","exports","module","../../math/QuadTree","../../math/collision","../../utils/array","../shared/position"],function(e,t,n){var r=e("../../math/QuadTree"),i=e("../../math/collision"),s=e("../../utils/array"),o=e("../shared/position"),u=new r,a=[],f={};t.defineGroupTargets=function(e,t){f[e]=t},t.reset=function(){u.resize(this.width,this.height)},t.update=function(){u.clear()},t.postUpdate=function(){for(var e=0,t=a.length;e<t;++e){var n=a[e],r=o.getBounds(n),l=u.retrieve(r);for(var c=0,h=l.length;c<h;++c){var p=l[c];if(p.id===n.id)continue;var d=f[n.collision.group];if(!d)continue;var v=this.getEntityById(p.id);if(!v||!s.contains(d,v.collision.group))continue;var m=i.testAABB(r,p);m.penetration>0&&this.triggerSystems("entityCollide",[n,v,m])}}a.length=0},t.entityUpdate=function(e,t){var n=e.collision;if(!n)return;var r=e.position,s=e.size;if(n.map){var f=this.map,r=e.position,s=e.size,l={x:0,y:0,width:f.tileWidth,height:f.tileHeight},c=f.getTilesByRect(r.x,r.y,s.width,s.height);for(var h=0,p=c.length;h<p;++h){var d=c[h],v=f.get(d.x,d.y);if(v===undefined||v<1)continue;var m=o.getBounds(e);l.x=d.x*f.tileWidth,l.y=d.y*f.tileHeight;var g=i.testAABB(m,l);g.penetration>0&&this.triggerSystems("entityMapCollide",[e,d.x,d.y,g])}}if(n.world){var y=0,b=0;r.x<0?(r.x=0,y=-1):r.x+s.width>this.width&&(r.x=this.width-s.width,y=1),r.y<0?(r.y=0,b=-1):r.y+s.height>this.height&&(r.y=this.height-s.height,b=1),(y!==0||b!==0)&&this.triggerSystems("entityWorldCollide",[e,y,b])}var m=o.getBounds(e);m.id=e.id,u.insert(m),a.push(e)}}),n("djinn/sim/systems/jump",["require","exports","module"],function(e,t,n){t.entityUpdate=function(e,t){var n=e.jump,r=e.velocity;if(!r||!n||!n.request)return;n.request=!1;if(n.count>=n.max)return;r.y=n.power,++n.count},t.entityCollide=function(e,t,n){if(!t.collision.solid)return;e.jump&&n.normal.y===-1&&(e.jump.count=0)},t.entityMapCollide=function(e,t,n,r){e.jump&&r.normal.y===-1&&(e.jump.count=0)},t.entityWorldCollide=function(e,t,n){e.jump&&n===1&&(e.jump.count=0)}}),n("djinn/sim/systems/mortal",["require","exports","module"],function(e,t,n){t.entityCollide=function(e){var t=e.mortal;if(!t)return;t.killOnEntityCollide&&(t.alive=!1)},t.entityWorldCollide=function(e){var t=e.mortal;if(!t)return;t.killOnWorldCollide&&(t.alive=!1)},t.entityMapCollide=function(e){var t=e.mortal;if(!t)return;t.killOnMapCollide&&(t.alive=!1)},t.postUpdate=function(){this.entities.forEach(function(e){e.mortal&&(!e.mortal.alive||e.mortal.health<=0)&&(this.triggerSystems("entityDie",[e]),this.fire("entityDie",[e]),this.despawnEntity(e))},this)}}),n("js/sim/systems/state",["require","exports","module"],function(e,t,n){t.entityUpdate=function(e,t){var n=e.state;if(!n)return;var r=n.values;for(var i in r)r[i]-=t,r[i]<=0&&delete r[i]}}),n("js/sim/shared/state",["require","exports","module"],function(e,t,n){t.addState=function(e,t,n){var r=e.state;if(!r)return!1;var i=r.values;t in i?i[t]+=n:i[t]=n},t.removeState=function(e,t){var n=e.state;if(!n)return!1;n.values[t]=0},t.hasState=function(e,t){var n=e.state;return n?!!n.values[t]:!1},t.getStateDuration=function(e,t){var n=e.state;return n?n.values[t]||0:0}}),n("js/sim/systems/input",["require","exports","module","djinn/math/Vector2","djinn/sim/shared/position","../shared/state"],function(e,t,n){var r=e("djinn/math/Vector2"),i=e("djinn/sim/shared/position"),s=e("../shared/state"),o=function(e,t){var n=e.input,r=e.velocity,i=t/1e3;n.y<0?s.hasState(e,"flapCooldown")||(s.addState(e,"flapCooldown",n.flapCooldown),r.y+=n.y*n.flapMod*i):n.y>0&&(r.y+=n.y*i);if(n.x!==0){var o=n.bankMod;r.y>0&&(n.x>0&&r.x<0||n.x<0&&r.x>0)&&(r.y-=n.bankFloatMod*i),o*=1+Math.abs(r.y)*2,r.x+=n.x*o*i}},u=function(e,t){var n=e.input;if(!n.sonarRequest||s.hasState(e,"sonarCooldown"))return;s.addState(e,"sonarCooldown",n.sonarCooldown);var o=this.createEntity("sonar");i.centerOnEntity(o,e),this.spawnEntity(o);var u=new r(e.facing);u.scale(n.sonarSpeed),o.velocity.x=u.x,o.velocity.y=u.y};t.entityUpdate=function(e,t){var n=e.input;if(!n)return;o.call(this,e,t),u.call(this,e,t)}}),n("js/sim/systems/pointer",["require","exports","module","djinn/math/core","djinn/math/random","djinn/math/Vector2","../shared/state"],function(e,t,n){var r=e("djinn/math/core"),i=e("djinn/math/random"),s=e("djinn/math/Vector2"),o=e("../shared/state");t.entitySpawn=function(e){var t=e.pointer,n=e.velocity;if(!t||!n)return;var o=i.range(t.speedMin*10,t.speedMax*10)/10,u=s.makeFromHeading(i.range(0,r.twoPi*10)/10);n.x=u.x*o,n.y=u.y*o},t.entityUpdate=function(e,t){var n=e.pointer,r=e.gravity;if(!n||!r)return;o.hasState(e,"stun")?r.value=6e-4:r.value=0}}),n("js/sim/systems/consumer",["require","exports","module"],function(e,t,n){t.entityCollide=function(e,t,n){var r=e.consumer,i=t.weight;if(!r||!i)return;var s=i.value*r.multiplier;r.duration=r.chainInterval,r.multiplier+=.5,r.weight+=s,t.mortal.alive=!1,this.fire("consumerConsume",[e,t,s]),this.fire("consumerUpdate",[e])},t.entityUpdate=function(e,t){var n=e.consumer;if(!n)return;n.multiplier>1&&(n.duration-=t,n.duration<=0&&(n.duration=0,n.multiplier=1))}}),n("js/sim/systems/hazard",["require","exports","module"],function(e,t,n){t.entityCollide=function(e,t,n){var r=e.hazard,i=t.mortal;if(!r||!i)return;r.kill&&(t.mortal.alive=!1,this.fire("hazardKill",[t]))}}),n("js/sim/systems/game",["require","exports","module","djinn/stage","djinn/math/random","djinn/math/collision"],function(e,t,n){var r=e("djinn/stage"),i=e("djinn/math/random"),s=e("djinn/math/collision"),o=0,u=0,a=0,f=function(e,t){var n=t.position,o={},u=r.width*1.25,a=r.height*1.25,f={x:n.x-u/2,y:n.y-a/2,width:u,height:a};do o.x=i.range(0,this.width-e.size.width),o.y=i.range(0,this.height-e.size.height);while(s.testPointInRect(o,f));e.position.x=o.x,e.position.y=o.y};t.reset=function(){console.log("game.reset()")},t.update=function(e){var t=this.getEntityByType("player");t||(o=0,u=0,a=0),o+=e;if(o>=1e3){o=0;var n=this.createEntity("spawner",{spawner:{type:"bug"}});f.call(this,n,t),this.spawnEntity(n)}u+=e;if(u>=5e3){u=0;var n=this.createEntity("spawner",{spawner:{type:"bug2"}});f.call(this,n,t),this.spawnEntity(n)}a+=e;if(a>=1e4){a=0;var n=this.createEntity("spawner",{spawner:{type:"owl"}});f.call(this,n,t),this.spawnEntity(n)}}}),n("js/sim/systems/owl",["require","exports","module","djinn/sim/shared/position","../shared/state"],function(e,t,n){var r=e("djinn/sim/shared/position"),i=e("../shared/state"),s=function(e){var t=e.owl,n=e.velocity;if(!t||!n)return;var i=this.getEntityByType("player");if(i){var s=r.getAimVector(e,i);s.scale(t.speed),e.velocity.x=s.x,e.velocity.y=s.y}};t.entitySpawn=function(e,t){s.call(this,e)},t.entityUpdate=function(e,t){var n=e.owl,r=e.gravity;if(!n||!r)return;i.hasState(e,"stun")?r.value=6e-4:r.value=0},t.entityCollide=function(e){e.collision.group==="solids"&&s.call(this,e)},t.entityWorldCollide=function(e){s.call(this,e)}}),n("js/sim/systems/stunner",["require","exports","module","../shared/state"],function(e,t,n){var r=e("../shared/state");t.entityCollide=function(e,t){var n=e.stunner;if(!n||!t.state||r.hasState(t,"stun"))return;r.addState(t,"stun",n.duration)}}),n("js/sim/systems/spawner",["require","exports","module","djinn/sim/shared/position"],function(e,t,n){var r=e("djinn/sim/shared/position");t.entityUpdate=function(e,t){var n=e.spawner;if(!n)return;n.elapsed+=t;if(n.elapsed>=n.duration){var i=this.createEntity(n.type);r.centerOnEntity(i,e),this.spawnEntity(i),e.mortal.alive=!1}}}),n("js/sim/systems/moon",["require","exports","module"],function(e,t,n){t.entityCollide=function(e,t,n){var r=e.moon,i=t.velocity;if(!r||!i)return;i.x*=1.01,i.y*=1.01,r.effect=r.effectDuration,this.fire("consumerUpdate",[t])},t.entityUpdate=function(e,t){var n=e.moon;if(!n)return;n.effect>0&&(n.effect-=t,n.effect<=0&&(n.effect=0))}}),n("js/sim/prefabs/actors",["require","exports","module"],function(e,t,n){t.player={position:{x:0,y:0},size:{width:40,height:40},facing:{x:0,y:1},velocity:{x:0,y:0},drag:{x:.01,y:.01},gravity:{value:6e-4},input:{bankMod:.5,bankFloatMod:.6,flapMod:20,flapCooldown:350,sonarCooldown:1e3,sonarRequest:!1,sonarSpeed:1.2,x:0,y:1},sonar:{request:!1,cooldown:500,speed:.6,x:0,y:1},bounce:{x:1,y:1},collision:{map:!0,group:"players",world:!0},mortal:{alive:!0},state:{values:{}},consumer:{duration:0,chainInterval:3e3,multiplier:1,weight:0}},t.bug={position:{x:0,y:0},size:{width:20,height:20},velocity:{x:0,y:0},gravity:{value:0},bounce:{x:1,y:1},collision:{map:!0,group:"bugs",world:!0},mortal:{alive:!0},state:{values:{}},pointer:{speedMin:.3,speedMax:.6},weight:{value:100}},t.bug2={position:{x:0,y:0},size:{width:30,height:30},velocity:{x:0,y:0},gravity:{value:0},bounce:{x:1,y:1},collision:{map:!0,group:"bugs",world:!0},mortal:{alive:!0},state:{values:{}},pointer:{speedMin:.2,speedMax:.5},weight:{value:500}},t.centipede={position:{x:0,y:0},size:{width:40,height:40},velocity:{x:0,y:0},gravity:{value:3e-4},bounce:{x:0,y:0},collision:{map:!0,group:"centipedes",world:!0},state:{values:{}},hazard:{kill:!0}},t.owl={position:{x:0,y:0},size:{width:40,height:40},velocity:{x:0,y:0},gravity:{value:0},bounce:{x:1,y:1},collision:{map:!0,group:"owls",world:!0},mortal:{alive:!0},state:{values:{}},owl:{cooldown:3e3,speed:.4},hazard:{kill:!0},state:{values:{}}}}),n("js/sim/prefabs/projectiles",["require","exports","module"],function(e,t,n){t.sonar={position:{x:0,y:0},size:{width:60,height:60},velocity:{x:0,y:0},mortal:{alive:!0,killOnEntityCollide:!0,killOnMapCollide:!0,killOnWorldCollide:!0},gravity:{value:0},collision:{map:!0,group:"sonar",world:!0},stunner:{duration:3e3,velocityMod:.75}}}),n("js/sim/prefabs/objects",["require","exports","module"],function(e,t,n){t.playerStart={position:{x:0,y:0,immovable:!0},size:{width:40,height:40}},t.moon={position:{x:0,y:0,immovable:!0},size:{width:240,height:240},collision:{map:!0,group:"moon",world:!0},moon:{duration:3e3,effect:0,effectDuration:1e3}},t.spawner={position:{x:0,y:0,immovable:!0},size:{width:40,height:40},spawner:{elapsed:0,duration:1e3,type:null},mortal:{alive:!0}}}),n("js/sim/Level",["require","exports","module","djinn/sim/World","djinn/sim/systems/physics","djinn/sim/systems/collision","djinn/sim/systems/jump","djinn/sim/systems/mortal","./systems/state","./systems/input","./systems/pointer","./systems/consumer","./systems/hazard","./systems/game","./systems/owl","./systems/stunner","./systems/spawner","./systems/moon","./prefabs/actors","./prefabs/projectiles","./prefabs/objects"],function(e,t,n){var r=e("djinn/sim/World"),i=e("djinn/sim/systems/physics"),s=e("djinn/sim/systems/collision"),o=e("djinn/sim/systems/jump"),u=e("djinn/sim/systems/mortal"),a=e("./systems/state"),f=e("./systems/input"),l=e("./systems/pointer"),c=e("./systems/consumer"),h=e("./systems/hazard"),p=e("./systems/game"),d=e("./systems/owl"),v=e("./systems/stunner"),m=e("./systems/spawner"),g=e("./systems/moon"),y=e("./prefabs/actors"),b=e("./prefabs/projectiles"),w=e("./prefabs/objects");n.exports=r.extend({init:function(e){this._super(e),this.width=2560,this.height=1440,this.addSystem(o),this.addSystem(u),this.addSystem(i),this.addSystem(s),this.addSystem(f),this.addSystem(a),this.addSystem(l),this.addSystem(c),this.addSystem(h),this.addSystem(p),this.addSystem(d),this.addSystem(v),this.addSystem(m),this.addSystem(g),this.definePrefabs(y),this.definePrefabs(b),this.definePrefabs(w),s.defineGroupTargets("players",["solids","bugs"]),s.defineGroupTargets("bugs",["solids"]),s.defineGroupTargets("centipedes",["solids","players","bugs","owls"]),s.defineGroupTargets("owls",["solids","players","bugs"]),s.defineGroupTargets("sonar",["bugs","solids","owls"]),s.defineGroupTargets("moon",["players"])}})}),n("djinn/view/Pawn",["require","exports","module","./View"],function(e,t,n){var r=e("./View"),t=n.exports=r.extend({init:function(e){var e=merge(e,t.defaults);this._super(e)},attachEntity:function(e){this.entity=e,this.sync()},detachEntity:function(){this.entity=null},attachAvatar:function(e){this.avatar=e,this.addChild(e),this.alignAvatar()},alignAvatar:function(){this.avatar.align("center","center")},despawn:function(){this.dispose()},sync:function(){var e=this.entity;if(!e)return;var t=e.size,n=e.position;this.x=Math.round(n.x),this.y=Math.round(n.y),this.width=t.width,this.height=t.height},tick:function(e){this.sync()}});t.defaults={width:32,height:32}}),n("djinn/view/TileMapRenderer",["require","exports","module","./View","../math/core","./utils/canvas","../assets"],function(e,t,n){var r=e("./View"),i=e("../math/core"),s=e("./utils/canvas"),o=e("../assets"),t=n.exports=r.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.offsetX=e.offsetX,this.offsetY=e.offsetY,this._tileMap=null,this.tileImage=e.tileImage},attach:function(e){this._tileMap=e},detach:function(){this._tileMap=null},setOffset:function(e,t){var n=this._tileMap;if(!n)return;this.offsetX=i.clamp(e,0,n.unitWidth-this.width),this.offsetY=i.clamp(t,0,n.unitHeight-this.height)},scroll:function(e,t){this.setOffset(this.offsetX+e,this.offsetY+t)},render:function(e){var t=this._tileMap,n=this._tileImage;if(!t||!n)return;var r=o.get(n);if(!r.ready)return;var i=~~this.offsetX,s=~~this.offsetY,u=t.tileWidth,a=t.tileHeight,f=t.unitToTile(i,s),l={x:Math.ceil((i+this.width)/u),y:Math.ceil((s+this.height)/a)},c={x:i%u,y:s%a};for(var h=f.y;h<=l.y;++h)for(var p=f.x;p<=l.x;++p){var d=t.get(p,h);if(d===undefined||d<1)continue;var v=(d-1)*u,m=0,g={x:(p-f.x)*u-c.x,y:(h-f.y)*a-c.y};e.drawImage(r,v,m,u,a,g.x,g.y,u,a)}}});t.defaults={offsetX:0,offsetY:0,tileImage:null};var u=t.prototype;Object.defineProperty(u,"tileImage",{set:function(e){this._tileImage=e,o.load(e)}})}),n("djinn/view/shapes/Rectangle",["require","exports","module","../View","../utils/canvas"],function(e,t,n){var r=e("../View"),i=e("../utils/canvas"),t=n.exports=r.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.fillColor=e.fillColor,this.strokeColor=e.strokeColor,this.strokeWidth=e.strokeWidth,this.borderRadius=e.borderRadius},render:function(e){i.drawRect(e,0,0,this.width,this.height,this.fillColor,this.strokeColor,this.strokeWidth,this.borderRadius)}});t.defaults={buffer:!0,width:100,height:100,fillColor:"white",strokeColor:null,strokeWidth:1,borderRadius:0}}),n("djinn/view/effects/Darkness",["require","exports","module","../shapes/Rectangle","../utils/canvas"],function(e,t,n){var r=e("../shapes/Rectangle"),i=e("../utils/canvas"),s=i.create(1e3,1e3),o=function(e,t){var n=e.a.x,r=e.a.y,i=e.b.x-e.a.x,s=e.b.y-e.a.y,o=t.a.x,u=t.a.y,a=t.b.x-t.a.x,f=t.b.y-t.a.y,l=Math.sqrt(i*i+s*s),c=Math.sqrt(a*a+f*f);if(i/l==a/c&&s/l==f/c)return null;var h=(i*(u-r)+s*(n-o))/(a*s-f*i),p=(o+a*h-n)/i;return p<0?null:h<0||h>1?null:{x:n+i*p,y:r+s*p,param:p}},t=n.exports=r.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.offsetX=e.offsetX,this.offsetY=e.offsetY},attach:function(e){this.world=e},detach:function(){this.world=null},setOffset:function(e,t){this.offsetX=e,this.offsetY=t},render:function(e){this._super(e);if(this.world){var t=this.world,n=this.offsetX,r=n+this.width,i=this.offsetY,u=i+this.height,a=s.getContext("2d");this.world.entities.forEach(function(f){if(!f.light)return;var l=f.position,c=f.size,h=f.light,p=l.x+c.width/2,d=l.y+c.height/2,v=p-h.radius,m=d-h.radius,g=h.radius*2,y=h.radius*2;if(v+g<n||v>r||m+y<i||m>u)return;var b=t.map.getSegmentsByRect(v,m,g,y);b.push([v,m,v+g,m],[v,m+y,v+g,m+y],[v+g,m,v+g,m+y],[v,m,v,m+y]);var w=[];for(var E=0,S=b.length;E<S;++E){var x=b[E],T=Math.atan2(x[1]-d,x[0]-p);w.indexOf(T)===-1&&w.push(T-1e-5,T,T+1e-5);var T=Math.atan2(x[3]-d,x[2]-p);w.indexOf(T)===-1&&w.push(T-1e-5,T,T+1e-5)}var N=[];for(var E=0,S=w.length;E<S;++E){var T=w[E],C=Math.cos(T),k=Math.sin(T),L={a:{x:p,y:d},b:{x:p+C,y:d+k}},A=null;for(var O=0;O<b.length;++O){var x=b[O],M=o(L,{a:{x:x[0],y:x[1]},b:{x:x[2],y:x[3]}});if(!M)continue;if(!A||M.param<A.param)A=M}A&&(A.angle=T,N.push(A))}N=N.sort(function(e,t){return e.angle-t.angle}),a.clearRect(0,0,g,y),a.beginPath(),a.moveTo(N[0].x-v,N[0].y-m);for(var E=1;E<N.length;E++){var M=N[E];a.lineTo(M.x-v,M.y-m)}a.fill(),a.closePath();var T=f.facing.angle-Math.PI/2,_=T-h.angle/2,D=T+h.angle/2,P=Math.cos(_),H=Math.sin(_),B=Math.cos(D),j=Math.sin(D);a.globalCompositeOperation="source-in",a.beginPath(),a.moveTo(p-v,d-m),a.lineTo(P,H),a.lineTo(B,j),a.lineTo(p-v,d-m),a.arc(p-v,d-m,h.radius,_,D),a.closePath(),a.fill(),a.globalCompositeOperation="source-over",e.globalCompositeOperation="destination-out",e.drawImage(s,0,0,g,y,v-n,m-i,g,y),e.globalCompositeOperation="source-over"})}},_checkBuffer:function(){this.redrawBuffer()}});t.defaults={fillColor:"rgba(0, 0, 0, 0.5)",offsetX:0,offsetY:0}}),n("djinn/view/WorldRenderer",["require","exports","module","./View","./Pawn","./TileMapRenderer","./effects/Darkness","../math/core"],function(e,t,n){var r=e("./View"),i=e("./Pawn"),s=e("./TileMapRenderer"),o=e("./effects/Darkness"),u=e("../math/core");n.exports=r.extend({init:function(e){this._super(e),this.world=null,this.pawns={},this._pawnFactory=null,this._avatarFactory=null,this.mapRenderer=new s({parent:this,visible:!1}),this._pawnContainer=new r({parent:this}),this.darkness=new o({parent:this,width:this.width,height:this.height})},attach:function(e){var t=e.entities.items;for(var n=0,r=t.length;n<r;++n){var i=t[n];i&&this._onWorldEntitySpawn(i)}e.on("reset",this,"_onWorldReset"),e.on("entitySpawn",this,"_onWorldEntitySpawn"),e.on("entityDespawn",this,"_onWorldEntityDespawn"),e.map&&e.map.size>0&&(this.mapRenderer.attach(e.map),this.mapRenderer.visible=!0),this.darkness.attach(e),this.world=e},detach:function(){var e=this.world;this.world=null,e&&e.removeListenersByContext(this),this.mapRenderer.detach(),this.darkness.detach(),this.clean()},clean:function(){this._pawnContainer.disposeChildren()},setPawnFactory:function(e){this._pawnFactory=e},setAvatarFactory:function(e){this._avatarFactory=e},render:function(e){this._updateCamera()},_updateCamera:function(){var e=this.world,t=e.camera,n=u.clamp(t.x-this.width/2,0,e.width-this.width),r=u.clamp(t.y-this.height/2,0,e.height-this.height);this._pawnContainer.x=-n,this._pawnContainer.y=-r,this.mapRenderer.setOffset(n,r),this.darkness.setOffset(n,r)},_onWorldReset:function(){this.clean()},_onWorldEntitySpawn:function(e){if(!this._pawnFactory||!this._avatarFactory){log.warn("[WorldRenderer._onWorldEntitySpawn] Missing pawn or avatar factory");return}var t=this._pawnFactory.create(e.type);t.attachEntity(e);var n=this._avatarFactory.create(e.type);return t.attachAvatar(n),this._pawnContainer.addChild(t),this.pawns[e.id]=t,t.spawn&&t.spawn(),t},_onWorldEntityDespawn:function(e){var t=this.pawns,n=t[e.id];n&&n.despawn&&n.despawn(),delete t[e.id]}})}),n("djinn/utils/Factory",["require","exports","module","../Class"],function(e,t,n){var r=e("../Class");n.exports=r.extend({init:function(e,t){this._fallback=e,this._extensions=t},create:function(e,t){var n=this._extensions,t=merge(t,{type:e});return e in n?n[e].create(t):this._fallback.create(t)}})}),n("js/view/pawns/Pawn",["require","exports","module","djinn/view/View","djinn/view/Pawn"],function(e,t,n){var r=e("djinn/view/View"),i=e("djinn/view/Pawn"),t=n.exports=i.extend({init:function(e){this._super(e),this.elapsed=0},despawn:function(){this.avatar.completeTween().tween({opacity:0,scale:3},500,null,bind(this,function(){this.dispose()}))},tick:function(e){this._super();if(!this.trail)return;var t=this.entity,n=t.velocity;if(!n)return;var i=Math.abs(Math.abs(n.x)>Math.abs(n.y)?n.x:n.y);if(i>.9){var s=.75;this.elapsed+=e,this.interval=100}else if(i>.6){var s=.5;this.elapsed+=e,this.interval=250}else if(i>.4){var s=.25;this.elapsed+=e,this.interval=500}if(this.elapsed>=this.interval){this.elapsed=0;var o=(new r({parent:this.parent,backgroundColor:this.avatar.backgroundColor,opacity:.5,width:this.width*s,height:this.height*s})).centerOn(this).tween({opacity:0},500,null,function(){o.dispose()})}}})}),n("js/view/pawns/Player",["require","exports","module","djinn/view/View","djinn/math/Vector2","./Pawn","../../sim/shared/state"],function(e,t,n){var r=e("djinn/view/View"),i=e("djinn/math/Vector2"),s=e("./Pawn"),o=e("../../sim/shared/state"),t=n.exports=s.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.flapped=!1,this.trail=!0,this._leftWing=new r({parent:this,backgroundColor:"#140c1c"}),this._rightWing=new r({parent:this,backgroundColor:"#140c1c"})},despawn:function(){this._super(),this._leftWing.visible=!1,this._rightWing.visible=!1},tick:function(e){this._super(e);var t=this.entity,n=t.velocity;if(n.y>.25){var r=new i(n.x,n.y);this.rotation=r.heading}else this.rotation=0;t.input.y===1?this.scaleX=.5:this.scaleX=1;if(this.flapped||!o.hasState(t,"flapCooldown"))return;this.flapped=!0,this._leftWing.completeTween().tween({x:-40},50).tween({x:0},250),this._rightWing.completeTween().tween({x:40},50).tween({x:0},250,null,bind(this,function(){this.flapped=!1}))}});t.defaults={width:40,height:40}}),n("js/view/pawns/Sonar",["require","exports","module","./Pawn"],function(e,t,n){var r=e("./Pawn"),t=n.exports=r.extend({init:function(e){this._super(e),this.trail=!0}})}),n("js/view/avatars/Default",["require","exports","module","djinn/view/View"],function(e,t,n){var r=e("djinn/view/View"),i={player:{backgroundColor:"#140c1c",width:40,height:40},bug:{backgroundColor:"#140c1c",width:20,height:20},bug2:{backgroundColor:"#140c1c",width:30,height:30},centipede:{backgroundColor:"#d04648",width:40,height:40},moon:{backgroundColor:"#deeed6",width:240,height:240},owl:{backgroundColor:"#d04648",width:40,height:40},sonar:{backgroundColor:"#deeed6",width:60,height:60}},t=n.exports=r.extend({init:function(e){var e=merge(e,i[e.type],t.defaults);this._super(e)}});t.defaults={width:40,height:40}}),n("js/view/avatarFactory",["require","exports","module","djinn/utils/Factory","./avatars/Default"],function(e,t,n){var r=e("djinn/utils/Factory"),i=e("./avatars/Default");n.exports=new r(i,{})}),n("js/view/pawns/Spawner",["require","exports","module","djinn/view/Pawn","../avatarFactory"],function(e,t,n){var r=e("djinn/view/Pawn"),i=e("../avatarFactory"),t=n.exports=r.extend({spawn:function(){var e=this.entity,t=e.spawner;if(!t)return;var n=i.create(t.type,{parent:this,opacity:0,scale:3}).align("center","center").tween({opacity:1,scale:1},t.duration)}})}),n("js/view/pawns/Moon",["require","exports","module","djinn/view/View","./Pawn"],function(e,t,n){var r=e("djinn/view/View"),i=e("./Pawn"),t=n.exports=i.extend({spawn:function(){var e=this._face=new r({parent:this,opacity:0});new r({parent:e,backgroundColor:"#6dc2ca",x:20,y:80,width:e.width/3,height:e.height/3}),new r({parent:e,backgroundColor:"#6dc2ca",x:e.width/2,y:100,width:e.width/3,height:e.height/3}),new r({parent:e,backgroundColor:"#6dc2ca",x:e.width/4,y:e.height/2+40,width:e.width/2,height:e.height/4}),this._aura=(new r({parent:this,backgroundColor:"#deeed6",opacity:0,width:this.width*2,height:this.height*2})).align("center","center")},tick:function(e){this._super(e);var t=this.entity,n=t.moon;if(n.effect>0){var r=n.effect/n.effectDuration;this._face.opacity=r*.25,this._aura.opacity=r*.25}}})}),n("js/view/pawnFactory",["require","exports","module","djinn/utils/Factory","./pawns/Pawn","./pawns/Player","./pawns/Sonar","./pawns/Spawner","./pawns/Moon"],function(e,t,n){var r=e("djinn/utils/Factory"),i=e("./pawns/Pawn"),s=e("./pawns/Player"),o=e("./pawns/Sonar"),u=e("./pawns/Spawner"),a=e("./pawns/Moon");n.exports=new r(i,{player:s,sonar:o,spawner:u,moon:a})}),n("js/view/LevelRenderer",["require","exports","module","djinn/view/WorldRenderer","./pawnFactory","./avatarFactory"],function(e,t,n){var r=e("djinn/view/WorldRenderer"),i=e("./pawnFactory"),s=e("./avatarFactory");n.exports=r.extend({init:function(e){this._super(e),this.setPawnFactory(i),this.setAvatarFactory(s),this.darkness.visible=!1}})}),n("js/view/Score",["require","exports","module","djinn/view/Text","djinn/math/core"],function(e,t,n){var r=e("djinn/view/Text"),i=e("djinn/math/core"),t=n.exports=r.extend({init:function(e){this._super(merge(e,t.defaults)),this.text=e.value;var n=e.value/3e3;this.fontSize=i.lerp(32,64,n,!0)}});t.defaults={fillColor:"#140c1c"}}),n("js/view/Multiplier",["require","exports","module","djinn/view/Text","djinn/math/core"],function(e,t,n){var r=e("djinn/view/Text"),i=e("djinn/math/core"),t=n.exports=r.extend({init:function(e){this._super(merge(e,t.defaults))},update:function(e){if(e.multiplier===1)return;this.completeTween({text:"x"+e.multiplier,opacity:1,visible:!0}).delayTween(e.chainInterval-1e3).tween({opacity:0,visible:!1},1e3)}});t.defaults={fillColor:"#deeed6",fontSize:64,strokeColor:"#63a0cc",strokeWidth:8}}),n("djinn/utils/base64",[],function(){var e={};return e.supported=Boolean(window.btoa&&window.atob),e.encode=function(e,t){return window.btoa?btoa(unescape(encodeURIComponent(String(e)))):e},e.decode=function(e,t){if(!window.atob)return e;try{e=decodeURIComponent(escape(atob(String(e))))}catch(n){logger.warn("[base64.decode] Could not decode: "+e),logger.warn("[base64.decode] "+n.message)}return e},e}),n("djinn/utils/obfuscate",["require","exports","module","./base64"],function(e,t,n){var r=e("./base64"),i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s="`1234567890-=[];',./~!@#$%^&*()_+{}|:<>?QWERTYUIOPASDFGHJKLZXCVBN",o=s.length,u=function(e){return e?e.length%o:0};t.encode=function(e,t){if(!r.supported)return e;var n=u(t),e=r.encode(e),a="";for(var f=0,l=e.length;f<l;++f){var c=i.indexOf(e[f]),h=(c+n)%o;a+=s[h]}return a},t.decode=function(e,t){if(!r.supported)return e;var n=u(t),a="";for(var f=0,l=e.length;f<l;++f){var c=s.indexOf(e[f]),h=c-n;h<0&&(h=o+h),a+=i[h]}return r.decode(a)}}),n("djinn/utils/storage",["require","exports","module","./obfuscate","./log"],function(e,t,n){var r=e("./obfuscate"),i=e("./log");t.set=function(e,t){var e=r.encode(e,e),t=r.encode(t,e);try{localStorage.setItem(e,t)}catch(n){i.warn("[storage.set] Failed to set localStorage! Quota exceeded?"),i.warn("[storage.set] "+n.message)}},t.get=function(e){var e=r.encode(e,e),t=null;try{t=localStorage.getItem(e)}catch(n){i.warn("[storage.get] Failed to get: "+e),i.warn("[storage.get] "+n.message)}return t&&(t=r.decode(t,e)),t},t.remove=function(e){var e=r.encode(e,e);try{localStorage.removeItem(e)}catch(t){i.warn("[storage.remove] Failed to remove: "+e),i.warn("[storage.remove] "+t.message)}},t.setObject=function(e,n){var r=JSON.stringify(n);return t.set(e,r)},t.getObject=function(e){var n=t.get(e),r=null;try{r=JSON.parse(n)}catch(s){i.warn("[storage.getObject] Could not parse JSON: "+n),i.warn("[storage.getObject] "+s.message)}return r}}),n("djinn/utils/object",["require","exports","module"],function(e,t,n){t.clone=function(e){return JSON.parse(JSON.stringify(e))},t.getKeys=function(e){var t=[];for(var n in e)t.push(n);return t},t.getLength=function(e){var t=0;for(var n in e)++t;return t},t.getRandomKey=function(e){return random.choice(t.getKeys(e))}}),n("djinn/utils/DataStore",["require","exports","module","../Emitter","./storage","./object"],function(e,t,n){var r=e("../Emitter"),i=e("./storage"),s=e("./object"),t=n.exports=r.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.key=e.key,this.load(),e.defaults&&(this.defaults=e.defaults,this.data=merge(this.data,e.defaults))},load:function(){if(this.key){var e=i.getObject(this.key);this.data=e||{}}else this.data={}},save:function(){if(!this.key)return;i.setObject(this.key,this.data)},set:function(e,t){if(this.data[e]===t)return;this.data[e]=t,this.save(),this.fire("set:"+e,[t])},get:function(e,t){var n=this.data[e];return n!==undefined?n:t},toggle:function(e){this.set(e,!this.get(e))},increment:function(e,t){var t=t||1,n=this.get(e,0);this.set(e,n+t)},restoreDefaults:function(e){if(!this.defaults)return;var t=s.clone(this.defaults);for(var n in t)(!e||n===e)&&this.set(n,t[n])}});t.defaults={key:null}}),n("js/data",["require","exports","module","djinn/utils/DataStore","djinn/manifest"],function(e,t,n){var r=e("djinn/utils/DataStore"),i=e("djinn/manifest"),s=r.extend({init:function(e){this._super({key:i.shortName+"_data",defaults:{best:0}})},getBest:function(){return this.get("best")},setBest:function(e){e>this.get("best")&&this.set("best",e)}});n.exports=new s}),n("js/view/Result",["require","exports","module","djinn/view/View","djinn/view/Text","../data"],function(e,t,n){var r=e("djinn/view/View"),i=e("djinn/view/Text"),s=e("../data"),t=n.exports=r.extend({init:function(e){this._super(merge(e,t.defaults)),this.score=(new i({parent:this,fillColor:"#deeed6",fontSize:64,strokeColor:"#63a0cc",strokeWidth:8,textAlign:"center"})).align("center"),this.best=new i({parent:this,text:"Best: 8000",fillColor:"#deeed6",fontSize:64,strokeColor:"#63a0cc",strokeWidth:8,textAlign:"center",y:this.score.bottom+32}),(new i({parent:this,text:"press (A) button or space bar",fillColor:"#deeed6",fontSize:32,strokeColor:"#63a0cc",strokeWidth:4,textAlign:"center",y:this.best.bottom+32})).align("center")},setScore:function(e){var t=this.score;t.text="Score: "+e,t.align("center"),s.setBest(e)},show:function(){var e=this.best;e.text="Best: "+s.get("best"),e.align("center"),this.completeTween({opacity:0,visible:!0}).tween({opacity:1},500)},hide:function(){this.completeTween().tween({opacity:0},500,null,bind(this,function(){this.visible=!1}))}});t.defaults={width:640,height:224}}),n("js/Bats",["require","exports","module","djinn/stage","djinn/assets","djinn/math/core","djinn/Game","djinn/view/View","djinn/view/Text","djinn/math/random","djinn/input/keyboard","djinn/input/gamepad","djinn/sim/shared/position","djinn/utils/viewEffects","./sim/Level","./view/LevelRenderer","./view/Score","./view/Multiplier","./view/Result"],function(e,t,n){var r=e("djinn/stage"),i=e("djinn/assets"),s=e("djinn/math/core"),o=e("djinn/Game"),u=e("djinn/view/View"),a=e("djinn/view/Text"),f=e("djinn/math/random"),l=e("djinn/input/keyboard"),c=e("djinn/input/gamepad"),h=e("djinn/sim/shared/position"),p=e("djinn/utils/viewEffects"),d=e("./sim/Level"),v=e("./view/LevelRenderer"),m=e("./view/Score"),g=e("./view/Multiplier"),y=e("./view/Result"),b=l.keys,w=[b.left,b.a],E=[b.right,b.d],S=[b.up,b.w],x=[b.down,b.s],T=c.buttons,N={P:"playerStart",B:"bug2",C:"centipede",O:"moon"},C=["bug","bug2","owl","spawner"];n.exports=o.extend({init:function(e){this._super(e),this.gameOn=!1;var t=this.view;t.backgroundColor="#63a0cc";var n=this.level=new d,r=n.map;r.tileWidth=40,r.tileHeight=40,r.resize(64,36),r.fill(0);var s=this.levelRenderer=new v({parent:t,z:2});s.mapRenderer.tileImage="media/images/tilemap.png",n.on("entityDespawn",this,"_onEntityDespawn"),n.on("consumerConsume",this,"_onConsumerConsume"),n.on("consumerUpdate",this,"_onConsumerUpdate"),s.attach(n),this._addClouds(),this._generateLevel(),this.addPlayer(),this.scoreText=new a({parent:t,text:"0",fillColor:"#140c1c",fontSize:64,strokeColor:"#63a0cc",strokeWidth:8,x:20,y:20,z:3}),this.multiplier=new g({parent:t,visible:!1,x:20,y:this.scoreText.bottom,z:3}),this.startText=(new a({parent:t,text:"⬇",fillColor:"#deeed6",fontSize:64,textAlign:"center",y:100,z:3})).align("center"),this.result=(new y({parent:t,visible:!1,z:3})).align("center","center"),this.title=(new a({parent:t,text:"Bats or whatever",fillColor:"#140c1c",fontSize:128,strokeColor:"#63a0cc",strokeWidth:16,textAlign:"center",z:3})).align("center","center"),t.sortChildren(),i.load["media/fonts/Pixelated.ttf"]},addPlayer:function(){var e=this.level,t=this.player=e.createEntity("player");e.spawnEntity(t);var n=e.getEntityByType("playerStart");t.position.x=n.position.x,t.position.y=n.position.y,e.setCameraTarget(t)},update:function(e){this.player.mortal.alive?this._handlePlayerInput():(l.isDown(b.space,!0)||c.isButtonDown(T.face1,!0))&&this._reset(),this.level.update(e)},startGame:function(){this.gameOn=!0,this.level.start(),this.startText.completeTween().tween({opacity:0});var e=this.title;e&&e.completeTween().tween({opacity:0},1e3,null,function(){e.dispose()})},_handlePlayerInput:function(){var e=this.level,t=this.player,n=t.facing,r=t.input;r.sonarRequest=!1,r.x=0,r.y=0,(l.isDown(b.escape,!0)||c.isButtonDown(T.start,!0))&&this.gameOn&&(e.running=!e.running);if(l.isDown(b.space)||c.isButtonDown(T.face1))t.input.sonarRequest=!0;if(l.isDown(w)||c.isButtonDown(T.dPadLeft)||c.isDirectionDown("left"))n.x=-1,n.y=0,r.x=-1;else if(l.isDown(E)||c.isButtonDown(T.dPadRight)||c.isDirectionDown("right"))n.x=1,n.y=0,r.x=1;if(l.isDown(S)||c.isButtonDown(T.dPadUp)||c.isDirectionDown("up"))n.x=0,n.y=-1,r.y=-1;else if(l.isDown(x)||c.isButtonDown(T.dPadDown)||c.isDirectionDown("down"))n.x=0,n.y=1,r.y=1,e.running||this.startGame()},_addClouds:function(){var e=this.level,t=this.levelRenderer._pawnContainer,n=this.clouds=new u({parent:t,opacity:.5,width:e.width,height:e.height}),r=this._makeCloud();r.x=f.range(0,n.width/2-r.width),r.y=f.range(0,n.height/2-r.height);var r=this._makeCloud();r.x=f.range(n.width/2,n.width-r.width),r.y=f.range(0,n.height/2-r.height);var r=this._makeCloud();r.x=f.range(0,n.width/2-r.width),r.y=f.range(n.height/2,n.height-r.height);var r=this._makeCloud();r.x=f.range(n.width/2,n.width-r.width),r.y=f.range(n.height/2,n.height-r.height);for(var i=0;i<3;++i){var r=this._makeCloud();r.x=f.range(0,n.width-r.width),r.y=f.range(0,n.height-r.height)}},_makeCloud:function(e,t){return new u({parent:this.clouds,backgroundColor:"#6dc2ca",width:f.range(300,600),height:f.range(300,600)})},_generateLevel:function(){var e=["xxxx.xxx.......x............xxx.........x......xx.....x...xx.xxx","xx...........................P..................x.............xx","x..............................................................x","................................................................","x........................b.......b..............................","................................................................","..............................................................xx","........................b.........b............................x",".......................................O.......................C","...............................................................x","C...............................................................","x...............................................................","................................................................","................................................................","................................................................","................................................................","................................................................","................................................................","................................................................","................................................................","................................................................","................................................................",".............................C.................................x",".............................x..................................","............................xx..................................","............................xx.................................C","............................xx.................................x",".............................x.................................x",".............................x..................................",".............................x..................................","............................xx..................................","x...........................xx.................................x","x...........................xxx...x.........................x.xx",".................C........x.xxx...x.........C...............xxxx","x.........C......x....x...xxxxxx.xx.x.......x........x.....xxxxx","xx........x......xx..xx...xxxxxxxxxxx.....x.xx......xxx...xxxxxx"];this._generateLevelFromMatrix(e)},_generateEntity:function(e,t,n){var r=this.level,i=r.createEntity(e);i.position.x=40*t,i.position.y=40*n,r.spawnEntity(i)},_generateLevelFromMatrix:function(e){var t=this.level.map;for(var n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r){var i=e[n][r],s=N[i];s&&this._generateEntity(s,r,n),i==="x"&&t.set(r,n,1)}},_onEntityDespawn:function(e){if(e.type==="player"){this.gameOn=!1,p.vibrate(this.view),this.result.setScore(this.player.consumer.weight),this.result.show();var t=this.level.entities.items;for(var n=0,r=t.length;n<r;++n){var e=t[n];e&&e.mortal&&C.indexOf(e.type)>-1&&(e.mortal.alive=!1)}}},_onConsumerConsume:function(e,t,n){var r=this.levelRenderer,i=r._pawnContainer,s=(new m({parent:i,value:n,textAlign:"center"})).centerOn(r.pawns[t.id]);s.tween({y:s.y-20},1e3).tween({opacity:0,y:s.y-40},1e3,null,function(){s.dispose()}),this._updateScore()},_onConsumerUpdate:function(e){this.multiplier.update(e.consumer)},_reset:function(){this.addPlayer(),this.level.stop(),this.startText.completeTween().tween({opacity:1}),this.result.hide(),this.multiplier.hide(),this._updateScore()},_updateScore:function(){this.scoreText.text=this.player.consumer.weight}}),a.defaults.fontFamily="Pixelated"}),t(["js/Bats"],function(e){var t=new e;t.run()}),n("_launch",function(){})})();;
</script>
</head>
<body></body>
</html>
